---
title: 三統曆
author: Chunyu Ge 葛淳宇
date: 2025-12-13
draft: yes
---

# 《漢書·律曆志》筆記（1）：中國傳統曆法的特點與《漢書·律曆志》的主要內容

## 中國傳統曆法的特點

中國傳統曆法有以下這些主要特點：

1. 用干支記錄日期
2. 以朔望月來確定月份
3. 以朔望月與回歸年的配合來確定一年的長度，也就是在哪些年份設置閏月，閏月設置在哪個月份
4. 除了年月日之外，還有完全由回歸年決定的二十四節氣
5. 除了編算年月日、節氣之外，還要推算五大行星的運行

以下就對這些特點進行詳細說明。

曆法的用處就是記錄時間。在地球上生活，最容易注意到的就是太陽的東昇西落。太陽升起一次、落下一次就是一天。月亮每隔一些天數就會由圓變缺、由缺變圓。在更長一點的時段，天氣會由寒轉暖、又由暖變冷。這些自然現象所展現的週期爲曆法提供了最基本的單位，也就是日、月、年。古人在持久的仔細觀測後，發現月亮由圓變缺的週期是大致固定的，大約是 29 天多。而天氣冷暖變遷的週期也大致是固定的，大約是 365 天。假如設置一個大月 30 天、一個小月 29 天的搭配，過幾個月的長度就接近一年。但是問題在於，設置十二個月的日數不足一年（$6 \times (29 + 30) = 354$），而設置十三個月的日數又超過一年（$6 \times (29 + 30) + 29 = 383$）。因此，有的古代文明就設置十二個整月，而將多出來的幾天單獨處理。假設一年固定 365 天，一個月 29 天，那十二個月之後，一年還剩 $365 - 12 \times 29 = 17$，這剩下的幾天就是單獨的一個月。例如，古埃及的曆法，每個月 30 天，一年 365 天，每十二個月之後又會增加 5 天。這五天叫做 *epagomenœ*，就是增加的日子[^egypt]。

[^egypt]: R. A. Parker, *The Calendars of Ancient Egypt*, University of Chicago Press, Chicago, 1950.

另外一種辦法是不固定每年的日數，每過幾年增加一個閏月。假設將一年分爲十二個月，大月 30 天、小月 29 天相交替，每過一年就多 $365 - 6 \times (29 + 30) = 11$，三年之後，多出來的日子就有 $11 \times 3=33$ 天，就可以多設置一個月，來安置多出來的這些日子。在日復一日的觀測之後，古人發現月亮盈虧和冷暖交替有一個大致的週期，大約 19 個整年之中有 235 次完整的月亮週期。中國古代將之稱爲一章，而古希臘人將之稱爲 *Metonic cycle*，以發現這一週期的古希臘數學家 *Meton of Athens* 命名。以此爲基礎，就可以在十九年之中設置七個閏月，也就是 $235 - 12 \times 19 = 7$。這就叫十九年七閏，中國早期的太初曆、三統曆都以這一週期爲基礎計算曆法。

一天雖然能很好地與日出、日落對應，但是何時爲一天的開始，卻沒有一個客觀的標準，或者說，一天從任何一個時間點開始都一樣。但是在古代計時還很原始，如果隨意選擇一個時刻爲一天的開始，那如何保證每天的開始都是在同一時刻呢？與此相應，每天日出和日落的時間是大致可以確定的。有些曆法就以日出（印度教曆法）或日落（希伯來曆法）爲一天的開始[^day]。中國傳統曆法則以午夜爲一天的開始，稱之爲“夜半”。

[^day]: 見 *Calendrical Calculations* 第14 頁的各種曆法紀日對照圖。

同樣地，一個月的開始也可以隨意設置，既可以是月亮最圓的那天，也可以是月亮最缺的那天。而中國傳統曆法以日月合朔爲一個月的開始。在這一天，月亮與太陽在天球上處在同一經度，在地球上月亮幾乎不可見。這天叫做“朔”，這就是合朔一詞的原由。月亮最圓的時候出現在每月的第十五或第十六天，第十五天叫做“望”。所以以月相爲基礎的一個月叫做“朔望月”。

一年的開始也沒有客觀的標準。中國古代有三正的說法。三正分別指夏正、殷正、周正。夏商周三代以不同的月份爲一年的起點，所以叫做三正。在夜晚的天空中，北斗七星很引人注意，而且在古代中國所處的地區，北斗七星一年四季都在天空。但是由於地球繞着太陽轉的週期與地球相對於遙遠恆星的旋轉週期的差距（也就是恆星年和回歸年的差距），星座在一年四季的位置是不同的。就北斗七星而言，不同季節一天相同時刻斗柄的指向就會不同[^biao]。《鶡冠子》說：“斗柄東指，天下皆春，斗柄南指，天下皆夏，斗柄西指，天下皆秋，斗柄北指，天下皆冬。”古人將斗柄的指向與地支相配合。而古人觀察斗柄指向的時間是每天剛日落時（《左傳正義·襄公二十七年》：“傳言辰在申者，謂其日昏時，斗柄所指於十二辰爲在申也。”）。也就是初昏時，斗柄指向東偏北方的時候就是現在的農曆正月，對應地支的寅，夏以此爲正月，叫做“建寅”；指向北偏東的時候是農曆十二月，殷以此爲正月，叫建丑；指向正北方的時候在農曆十一月，周以此爲正月，叫建子。下面的圖就展示了北斗七星的指向與夏、商、周正月份的關係，圓圈從內往外依次是斗建、夏正、商正、周正。

![斗建方位與夏正月份對照圖](/Users/chunyu/Documents/notes/topics/santongli/fig/doujian.png){width=32%}

| 三正 | 斗柄指向 | 地支/斗建 | 農曆月份 |
| ---- | -------- | --------- | -------- |
| 夏正 | 東偏北 | 建寅 | 正月 |
| 殷正 | 北偏東 | 建丑 | 十二月 |
| 周正 | 正北 | 建子 | 十一月 |

[^biao]: 古人認爲北斗七星的形狀像斗，斗是一種長柄的舀水器，也寫作枓。《史記·趙世家》趙襄子請代王吃飯的時候，就暗中命令廚人用斗柄擊殺代王。由此可知，斗的柄一定相當長，不然無法用來殺人。斗的容水部分叫做“魁”，而柄叫做“杓”（biāo，甫遙切）。《史記·天官書》索隱引春秋運斗樞云“斗，第一天樞，第二旋，第三璣，第四權，第五衡，第六開陽，第七搖光。第一至第四爲魁，第五至第七爲標，合而爲斗。”

中國古代是用干支來紀日的。十天干、十二地支相互組合，可以形成從甲子到癸亥、週期爲六十的天干地支序列，見下表。古人就以六十干支來紀日，每六十天一次循環。每個日子都有對應的干支名稱，叫做日名。一月 29 天、一年三百多天，都不是六十的整數倍。所以干支紀日是相對獨立於月份和年份的。現代的格里高利曆，每月第一天都是一號，而每年第一天都是一月一日。但是以干支紀日，假設第一年的第一天是甲子，一個月 29 天之後第二個月第一天的干支的序號就是 30，對應癸巳（注意，下面的干支表是以 0 爲開始的）。那過六十天之後又要開始一個週期。一年 365 天，有六個干支週期，又多出五天。所以第二年第一天是己巳。這也就是中國曆法要計算特定日期的干支日名的原因。

: 六十干支表

|       |        |         |        |         |        |
|:------|:-------|:--------|:-------|:--------|:-------|
|0 甲子 |10 甲戌 |20 甲申  |30 甲午 |40 甲辰  |50 甲寅 |
|1 乙丑 |11 乙亥 |21 乙酉  |31 乙未 |41 乙巳  |51 乙卯 |
|2 丙寅 |12 丙子 |22 丙戌  |32 丙申 |42 丙午  |52 丙辰 |
|3 丁卯 |13 丁丑 |23 丁亥  |33 丁酉 |43 丁未  |53 丁巳 |
|4 戊辰 |14 戊寅 |24 戊子  |34 戊戌 |44 戊申  |54 戊午 |
|5 己巳 |15 己卯 |25 己丑  |35 己亥 |45 己酉  |55 己未 |
|6 庚午 |16 庚辰 |26 庚寅  |36 庚子 |46 庚戌  |56 庚申 |
|7 辛未 |17 辛巳 |27 辛卯  |37 辛丑 |47 辛亥  |57 辛酉 |
|8 壬申 |18 壬午 |28 壬辰  |38 壬寅 |48 壬子  |58 壬戌 |
|9 癸酉 |19 癸未 |29 癸巳  |39 癸卯 |49 癸丑  |59 癸亥 |

光計算日期的干支日名還不夠，月份也需要計算。前面已經說過，中國傳統曆法十九年中有七個閏月，如何決定一年有沒有閏月、有閏月又應該放在哪個月，這也是需要計算的。在春秋時期，閏月是放在十二個月之後的，也就是“歸餘於終”（《左傳·文公元年》）。但是到了漢代，已經確定了閏月是設置於沒有中氣的月份的規則。但是，何謂中氣呢？

: 二十四節氣，以冬至爲起始

|冬      |春      |夏      |秋      |
|:-------|:-------|:-------|:-------|
|21 立冬 |3 立春  |9 立夏  |15 立秋 |
|22 小雪 |4 驚蟄  |10 小滿 |16 處暑 |
|23 大雪 |5 雨水  |11 芒種 |17 白露 |
|0 冬至  |6 春分  |12 夏至 |18 秋分 |
|1 小寒  |7 穀雨  |13 小暑 |19 寒露 |
|2 大寒  |8 清明  |14 大暑 |20 霜降 |

中國傳統曆法雖然以朔望月確定月份，但是另一方面又要配合太陽的週期。太陽經過春分點，季節進入春季，是春耕的關鍵時期；太陽到達冬至點，是一年夜晚最長的一天。這些時間點對於農業活動都非常重要。所以爲了安排農事，中國傳統曆法還將一年分爲二十四節氣，而二十四節氣完全是按照太陽的運行決定的，從本質上來說是一種太陽曆。這二十四個節氣，傳統曆法將它們分爲中氣和節氣，例如冬至是中氣，那下一個節氣小寒就是節氣，再下一個節氣大寒又是中氣。一年二十四節氣，其中十二個中氣、十二個節氣。對節氣的推算完全是根據太陽運行的週期來的，也就是完全根據回歸年的長度。將一個回歸年平均分爲二十四份，每一份就是一個節氣的長度；將回歸年分爲十二份，每一份就是一個節氣的長度。那麼，既然十二個朔望月的長度不到一年，而十二個中氣加起來恰好是一年，一個中氣就比一月略長。假設月份和節氣同時開始，一月結束時，中氣就會比月份多出一段。當這一段多出的時間不斷累積，達到一個月的長度的時候，就是需要設置閏月的時候。

![月份、中氣長度對照圖](/Users/chunyu/Documents/notes/topics/santongli/fig/zhqi.png){width=80%}

上面這張圖展示了三年之中中氣相對於月份的位置。圖中位置都是按照三統曆的數值計算出來的。粉紅色的點是月份的位置，藍色的點是中氣的位置。一個月的長度是 1，而一個中氣的長度是 $\frac{235}{228} = 1.0307$，所以第一年第一個月過後中氣的位置比月份稍後。一年過後，中氣比月份顯著多出一段。也就是說，中氣的位置逐漸從月初轉向月中、月末。到了第三年九月[^jiuyue]，中氣出現在九月底，而下一個中氣出現在十一月初，也就是本年十月沒有中氣。因此，本年需要閏九月。

[^jiuyue]: 注意，圖中標記月份的數字都是標在月底。例如，圖中標一月的位置是一月的結束、二月的開始。

這也就是說，中國傳統曆法不僅要計算特定年份相對於曆法起點過了多少天（用以確定特定日子的干支日名），還需要確定哪些年份有閏月，如果有閏月的話，閏月在哪個月；而對閏月的計算又涉及到對節氣的推算。這些是中國傳統曆法計算的主要部分。這一部分在《律曆志》中稱作“統術”，而與這部分的推算相關的常數叫做“統母”。

但是，除了對年月日的計算之外，中國傳統曆法還有其他的任務，就是對天體運行的計算。例如，每隔一段時間，就會發生月食。計算哪個月會發生月食，也是傳統曆法的內容。不僅如此，傳統曆法還需要推算水星、金星、火星、木星、土星五大行星的位置和出現時間等信息。五大行星中最重要的是木星。在春秋時期，古人就已經發現木星的週期大約是十二年，因此古人將天空平均分爲十二個區域。當某年木星運行到哪個區域時，就以這個天區來給當年命名。因爲古人把在一個地方停留超過兩夜叫做“次”[^ci]，所以木星停留在一個天區就叫“一次”，而十二個天區就稱爲十二次。下面的表格就是《漢書·律曆志》中給出的十二次的名稱，與每次的起始度數、終到度數、總度數，都以二十八宿爲參考。因爲先秦的人有以木星所在次來紀年的辦法，所以爲了確定所說的具體是哪一年就需要對木星的位置進行推算。劉歆已經發現了木星的週期不到十二年，大約每十二個週期就會多走一個星次。現代發現木星週期大約是 11.86 年，每十二個週期 $12 \times 11.86 = 142.32$，比 12 年一個週期少了一次多 $12 \times 12 = 144 - 142.32 = 1.68$。所以劉歆發明了“歲星超辰”的辦法，木星每走十二個週期，就會在十二次中跳一個，多走一次。這就是《律曆志》“歲術”部分推算的內容。

[^ci]: 《左傳·莊公三年》：“一宿爲舍，再宿爲信，過信爲次。”也就是說，住一夜叫舍，住兩夜叫信，住兩夜以上叫次。木星在一個天區會停留一年左右，時間比較長，所以叫次。而其他恆星則將天空分爲二十八個天區，稱之爲二十八宿，因爲日、月在每個天區停留的時間較爲短暫，所以稱之爲宿或舍。古代也有將二十八宿稱作二十八舍的叫法。

|十二次   |初度數     |終度數       |總度數         |
|:--------|:----------|:------------|:--------------|
|0 星紀   |初斗十二度 |終於婺女七度 |$30\frac{1}{4}$|
|1 玄枵   |初婺女八度 |終於危十五度 |30             |
|2 諏訾   |初危十六度 |終於奎四度   |31             |
|3 降婁   |初奎五度   |終於胃六度   |30             |
|4 大梁   |初胃七度   |終於畢十一度 |30             |
|5 實沈   |初畢十二度 |終於井十五度 |31             |
|6 鶉首   |初井十六度 |終於柳八度   |30             |
|7 鶉火   |初柳九度   |終於張十七度 |31             |
|8 鶉尾   |初張十八度 |終於軫十一度 |30             |
|9 壽星   |初軫十二度 |終於氐四度   |31             |
|10 大火  |初氐五度   |終於尾九度   |30             |
|11 析木  |初尾十度   |終於斗十一度 |31             |

除了木星在特定年份出現在哪個天區，傳統曆法還要計算木星何時出現，以及出現的具體位置，也包括其他四大行星的出現時間、位置等信息。對這些內容的計算對應《律曆志》中的“紀術”部分，而與這些計算有關的常數則叫做“紀母”[^jimu]。

[^jimu]: 今本誤作統母，李銳在《三統術注》中認爲應該是紀母。統母是與統術相應的常數，那與紀術相應的常數也應該是紀母，而不是統母。

因爲曆法既要推算年月日，又要推算五大行星的運行，所以傳統曆法設置了上元。簡單來說，上元就是日月和五大行星週期的最小公倍數。太極上元與統母、紀母這些在曆法計算中最基本的常數都會在“基本數據與表格”部分進行介紹。

## 《漢書·律曆志》主要內容

《漢書·律曆志》分爲上下兩卷，上卷分爲兩個部分，第一部分又分爲五個小部分，備數、和聲、審度、嘉量、權衡，講數和律呂、度量權衡的相生關係；第二部分講曆數自上古到太初改曆，下及劉歆作《三統曆》的歷史演變，並且說明曆書中所用的重要數字與天道人事的關係。下卷分爲統母，講三統曆所用的重要參數；紀母，推步五星的基本數據；五步，五星運行的基本軌跡與度數；統術，三統曆的基本原理；紀術，推步五星的基本原理；歲術，計算歲星位置的方法；世經，用三統曆推算出的自太昊帝以來的年曆。爲了看起來清楚，以下將《律曆志》主要內容寫成列表。

- 上卷：
  * 第一部分：以律起曆
    + 備數
    + 和聲
    + 審度
    + 嘉量
    + 權衡
  * 第二部分：曆法沿革
    + 自“曆數之起上矣”至“至孝成世，劉向總六曆，列是非，作五紀論” ：
      + 從顓頊至漢成帝的曆法沿革
    + 自“向子歆究其微眇，作三統曆及譜以說春秋，推法密要，故述焉。”至上卷末尾：
      + 三統曆撰作目的與基本數據
- 下卷：
  * 統母：日月運行的參數
  * 紀母：五星運行的基本數據
  * 五步：五星運行的基本軌跡與度數
  * 統術：如何推算三統曆日名、置閏、節氣、日月運行等
  * 紀術：推步五星的基本算法
  * 歲術：計算歲星位置的方法
  * 世經：用三統曆推算出的自太昊帝以來的年曆

# 《漢書·律曆志》筆記（2）：表格與常數

《漢書·律曆志》卷下的主要內容是三統曆的常數、計算法和以三統曆推算的自太皞以來到漢代的年曆。三統曆設置的常數是曆法計算的基礎。三統曆設置的常數，包括用於計算年月日的統母、計算五星運行的紀母，和最重要的太極上元。以下從太極上元開始，依次對這些常數的數值計算和意義進行解釋。三統曆對統法的解釋牽扯到很多律曆和數術的概念，導致原本十分清楚的計算過程難以理解。所以在解釋統母之前，直接將這些數字與三統曆基本基本時間單位的時間長度聯繫起來進行解釋。在統母、紀母部分之後，三統曆還有一份五星運行軌跡、日期、度數的表格，叫做五步。這裏將五步的表格放在常數後面介紹。另外，除了這些常數和五星運行數據之外，三統曆的計算還要用到六十干支表、二十四節氣表、十二次度數表，以及二十八宿距度表，這些表格解釋完常數和五步之後進行介紹。

## 太極上元的設定

三統曆設立了太極上元。太極上元是日月、五星的共同會合週期，也就是在這一時刻，日月五星的在天空中位於同一經度，同時這一時刻必須恰好是天統甲子統首年天正月朔日夜半，而且冬至也正好在這一時刻。從數學上來看，太極上元就是日月、五星週期的最小公倍數。已知日月合朔的週期爲 4617 年；木星週期 1728 年，金星週期 3456 年，土星週期 4320 年，火星週期 13824 年，水星週期 9216 年，五星週期的最小公倍數爲 138240，也就是五星會合週期，或稱作五星會終。那日月週期和五星週期的最小公倍數就是 23639040。《律曆志》在卷上末尾處指出太極上元的具體數目是 23639040，正好是日月五星週期的最小公倍數；又在世經部分指出太初元年距上元 143127 年。

設立太極上元的意義在於便利曆法計算，更確切地說是爲了方便計算五星出現的時間和度數。原因在於三統曆將天體運行看作一個個週期，要計算某年某月某日處在這些週期的哪個位置，就可以利用這些週期進行計算。而要考慮所有天體運行的情況，勢必要考慮所有天體運行的週期。這就是設立太極上元的理念。而這一個大週期對曆法計算的意義將會在三統曆算法的基本思路部分詳細討論。

## 三統曆基本時間單位的時間長度

三統曆對曆法基本數據的編排不夠清楚明晰，同時又牽扯到音律、度量衡等等，使得本來可以很清楚的數據變得難以理解。所以這裏以年、月、日爲單位計算出三統曆的基本時間單位。這樣與統母中的數字對照，不僅一目瞭然，而且對於後面用這些數字來進行曆法計算，也會方便很多。這裏先列出基本時間數據，和簡明的計算公式，下面再詳細解釋這些數字。

三統曆的基本時間單位有（時刻、）日、月（朔望月）、節氣、中氣、年（回歸年）、章、統、元等。三統曆的一個月是一個朔望月，一年是一個回歸年。注意，在實際的曆法編排中，一個月能夠精確地對應上一個朔望月，但是曆法中的一年並不能精確對應一個回歸年。

| 時間單位 | 年    | 月 | 日 | 中氣 |
| :------- | :----- | :------ | :---- | :---- |
| 日 |  |  | 1 | |
| 策餘 8080 | | | $365 \frac{385}{1539} - 360 = 5 \frac{385}{1539} = \frac{8080}{1539}$ | |
| 月 |  | 1 | $29 \frac{43}{81} = \frac{2392}{81} = \frac{\text{月法}}{\text{日法}}$  | |
| 節氣 | $\frac{1}{24}$ |  | $365 \frac{385}{1539} \div 24 = \frac{70265}{4617} = 15 \frac{1010}{4617}$ | |
| 中氣 | $\frac{1}{12}$ | $\frac{235}{19} \div 12 = \frac{235}{228} = \frac{\text{章月}}{\text{章中}}$ | $365 \frac{385}{1539} \div 12 = \frac{140530}{4617} = \frac{\text{中法}}{\text{元法}} = 30 \frac{2020}{4617}$ | 1 |
| 年 | 1 | $\frac{235}{19} = \frac{\text{章月}}{\text{章歲}}$ | $365 \frac{385}{1539} = \frac{562120}{1539} = \frac{周天}{統法}$ | 歲中 12 |
| 章 | 閏法/章歲 19 | 章月 235 | $365 \frac{385}{1539} \times 19 = \frac{10680280}{1539} = \frac{562120}{81}$ | 章中 $12 \times 19 = 228$ |
| 周至 | 周至 $3 \times 19 = 57$ | | | |
| 篇 | 篇 $4 \times 19 = 76$ | | | |
| 統 | 統法 $81 \times 19 = 1539$ | 統月 $81 \times 235 = 19035$ | 周天 $81 \times \frac{562120}{81} = 562120$ | 統中 $81 \times 228 = 18468$ |
| 元 | 元法 $3 \times 1539 = 4617$  | 元月 $3 \times 19035 = 57105$ | $3 \times 562120 = 1686360$ | 元中 $3 \times 18468 = 55404$ |
| 一個月食週期 | | 朔望之會 135 |
| 會月 | | 會月 $會數 \times 朔望之會 = 47 \times 135 = 6345$ |

: 三統曆基本時間單位年月日時長

最後兩行是月食週期。一個月食週期 135 個月，總共 23 次月食。47 個月食週期總共 6345 個月。

## 統母：日月運行的基本參數

三統曆以 19 年爲一章。十九年一章的意義是月相以十九年爲週期。十九年七閏，總共 $12 \times 19 + 7 = 235$ 月。三章爲一周至，周至 57 年。三統曆又將 81 章定爲一統，一統 $19 \times 81 = 1539$ 年，叫做**統法**。一統總共有 19035 個月。三統爲一元，一元總共 $3 \times 81 \times 19 \times = 4617$ 年，叫做**元法**。一元總共有 57105 個月。將這些寫成算式就是：

\begin{align*}
\text{章歲} &=19\\\\
\text{章月} &=19 \times 12 + 7\\\\
&=235\\\\
\text{周至} &= 3 \times \text{章歲}\\\\
&=3 \times 19\\\\
&=57\\\\
\text{統法} &= 81 \times \text{章歲}\\\\
&=81 \times 19\\\\
&= 1539\\\\
\text{統月} &=81 \times \text{章月}\\\\
&= 81 \times 235\\\\
&=19035\\\\
\text{元法} &= 3 \times \text{統歲}\\\\
&=3 \times  1539\\\\
&= 4617\\\\
\text{元月} &=3 \times \text{統月}\\\\
&= 3 \times 19035\\\\
&=57105
\end{align*}

曆法最基本的常數是朔望月和回歸年的長度。三統曆將朔望月長度定爲 $29 \frac{43}{81} = \frac{2392}{81}$ 日，而一年長度是由朔望月算出來的。十九年一章，一章有七個閏月，總共 235 個月，十九年的總日數就是 $\frac{562120}{81}$，一年平均日數就是 $365 \frac{385}{1539}$。寫成算式就是：

\begin{align*}
\text{一月日數}&= 29 \frac{43}{81}\\\\
&=\frac{2392}{81}\\\\
\text{一章日數}&= \text{章月} \times \text{一月日數}\\\\
&= 235 \times \frac{2392}{81}\\\\
&= \frac{562120}{81}\\\\
\text{一年平均日數}&= \text{一章日數} \div \text{章歲}\\\\
&= \frac{562120}{81} \div 19 \\\\
&= 365 \frac{385}{1539}
\end{align*}

這裏出現的所有數字三統曆都給了它一個名字。下面的表格就是三統曆給每個數字所起的名字：

| 統母   | 數值    |
|------- | ------- |
| 日法   |  81  |
| 閏法/章歲 | 19   |
| 統法   |  1539  |
| 月法   |  2392  |
| 周天   |  562120  |
| 章月   |  235  |

三統曆認爲月食週期是 $5 \frac{20}{23} = \frac{135}{23}$ 個月，也就是 135 個月總共有 23 次月食。135 月就稱作**朔望之會**。47 個月食週期正好等於 27 章，47 稱作**會數**，也就是：

\begin{align*}
&\ \ \ \ \ \ \text{47 個月食週期}\\\\
&= 47 \times 135 \\\\
&= 6345\\\\
&=\text{27 章}\\\\
&= 27 \times 235\\\\
\end{align*}

47 個月食週期等於 6345 個月，叫做**會月**。

二十四節氣依次一爲節氣、一爲中氣，一年就是十二節氣、十二中氣。一章的中氣總數就是 $19 \times 12 = 228$，叫做**章中**。一統 1539 年，一統的中氣總數是 $1539 \times 12 =18468$，叫做**統中**。一元三統 4617 年，一元的中氣總數就是 $4617 \times 12 = 55404$，叫做**元中**。

這些參數統稱爲統母。也就是下面統母表中列的這些。

|統母        |定義                                     |數值    |律曆志定義                             |
|:-----------|:----------------------------------------|:-------|:--------------------------------------|
|日法        |一日分爲 81 分                           |81      |元始黃鐘初九自乘，一龠之數，得日法。   |
|閏法        |19 歲一章，一章 7 閏                     |19      |合天地終數，得閏法。因爲章歲           |
|統法        |一統的年數                               |1,539   |以閏法乘日法，得統法。                 |
|元法        |一元的年數                               |4,617   |參統法，得元法。                       |
|會數        |47 個月食週期等於 27 個日月運行週期      |47      |參天九，兩地十，得會數。               |
|章月        |日月運行合併週期                         |235     |五位乘會數，得章月。                   |
|月法        |一月日數                                 |2,392   |推大衍象，得月法。                     |
|通法        |月法與中法的公約數                       |598     |四分月法，得通法。                     |
|中法        |一元中每個中氣的總日數                   |140,530 |以章月乘通法，得中法。                 |
|周天        |一統的日數                               |562,120 |以章月乘月法，得周天。                 |
|歲中        |每年的中氣數                             |12      |以三統乘四時，得歲中。                 |
|月周        |一章中月行週期數                         |254     |以章月加閏法，得月周。                 |
|朔望之會    |月食週期                                 |135     |參天數二十五，兩地數三十，得朔望之會。 |
|會月        |一會數的總月數                           |6,345   |以會數乘朔望之會，得會月。             |
|統月        |一統的總月數                             |19,035  |參會月，得統月。                       |
|元月        |一元的總月數                             |57,105  |參統月，得元月。                       |
|章中        |每章歲的中氣數                           |228     |以閏法乘歲中，得章中。                 |
|統中        |每統歲的中氣數                           |18,468  |以日法乘章中，得統中。                 |
|元中        |每元歲的中氣數                           |55,404  |參統中，得元中。                       |
|策餘        |一年長度與每年中氣總數的差               |8,080   |什乘元中，以減周天，得策餘。           |
|周至        |三章的年數                               |57      |參閏法，得周至。                       |

## 紀母：五星運行的基本參數

紀母，是推算五大行星運行的基本數據。外行星木星（歲星）、土星（鎮星）、火星（熒惑）有小周、歲數、見中分、積中、中餘、見中法、見閏分、積月、月餘、見月法、見中日法、見月日法十二個參數；而內行星金星（太白）、水星（辰星）除了五星都有的參數之外，還有晨中分、夕中分與積中、中餘，和晨閏分、夕閏分與積月、月餘十二個參數。

在紀母最後，還列出了紀母各個數值之間的關係：

> 以星行率減歲數，餘則見數也。\
東九西七乘歲數，并九七爲法，得一，金、水晨夕歲數。\
以歲中乘歲數，是爲星見中分。\
星見數，是爲見中法。\
以歲閏乘歲數，是爲星見閏分。\
以章歲乘見數，是爲見月法。\
以元法乘見數，是爲見中日法。\
以統法乘見數，是爲見月日法。\

紀母中最基本的數值是歲數和見中法，紀母中的其他數值都能從中推算而出。下面的表格就是紀母各項數值的計算公式（據《中國古代曆法》271 頁）。

| 紀母 | 公式 |
| -------------- | --------------- |
| 小周 | |
| 歲數 | |
| 見中分 | $\text{歲數}\times 12$ |
| 見中法 | |
| $\text{積中} \frac{\text{中餘}}{見中法}$ | $\frac{\text{見中分}}{\text{見中法}}$ |
| $\text{積中}$ | $\text{見中分} \ \mathbf{div}\ \text{見中法}$ |
| $\text{中餘}$ | $\text{見中分} \ \mathbf{mod}\ \text{見中法}$ |
| 見閏分 | $\text{歲數} \times 7$ |
| $\text{積月} \frac{\text{月餘}}{\text{見月法}}$ | $\frac{\text{歲數} \times 235}{19 \times \text{見中法}}=\frac{\text{歲數} \times 235}{\text{見月法}}$ |
| 積月 | $\text{歲數} \times 235 \ \mathbf{div}\ \text{見月法}$ |
| 月餘 | $\text{歲數} \times 235 \ \mathbf{mod}\ \text{見月法}$ |
| 見月法 | $19 \times \text{見中法}$ |
| 見中日法 | $\text{見月日法}\times 3$ |
| 見月日法 | $\text{見月法} \times \text{日法}=\text{見中法}\times 1539$ |
| 晨中分 | $\text{見中分} \times \frac{9}{16}$ |
| $\text{晨積中}\frac{\text{中餘}}{\text{見中法}}$ | $\frac{\text{晨中分}}{\text{見中法}}$ |
| 積中 | $\text{晨中分} \ \mathbf{div}\ \text{見中法}$ |
| 中餘 | $\text{晨中分} \ \mathbf{mod}\ \text{見中法}$ |
| 夕中分 | $\text{見中分} \times \frac{7}{16}$ |
| $\text{夕積中}\frac{\text{中餘}}{\text{見中法}}$ | $\frac{\text{夕中分}}{\text{見中法}}$ |
| 積中 | $\text{夕中分} \ \mathbf{div}\ \text{見中法}$ |
| 中餘 | $\text{夕中分} \ \mathbf{mod}\ \text{見中法}$ |
| 晨閏分 | $\text{見閏分} \times \frac{9}{16}$ |
| $\text{晨積月} \frac{\text{月餘}}{\text{見月法}}$ | $\frac{\text{歲數} \times 235}{\text{見月法}} \times \frac{9}{16}$ |
| 積月 | $(\text{歲數} \times 235 \times 9) \ \mathbf{div}\ (\text{見月法}\times16)$ |
| 月餘 | $(\text{歲數} \times 235 \times 9) \ \mathbf{mod}\ (\text{見月法}\times16)$ |
| 夕閏分 | $\text{見閏分} \times \frac{7}{16}$ |
| $\text{夕積月} \frac{\text{月餘}}{\text{見月法}}$ | $\frac{\text{歲數} \times 235}{\text{見月法}} \times \frac{7}{16}$ |
| 積月 | $(\text{歲數} \times 235 \times 7) \ \mathbf{div}\ (\text{見月法}\times16)$ |
| 月餘 | $(\text{歲數} \times 235 \times 7) \ \mathbf{mod}\ (\text{見月法}\times16)$ |

首先，小周是五大行星的小週期；歲數則是五大行星周天的最少整年數。例如，木星一個小周的粗略週期是 12 年，而一個大週期的年數，即歲數則是 1728。它的意義是木星在 1728 年中行 145 周天。

見中分是行星歲數所含中氣數，每年十二個中氣，歲數所含中氣數就是：$\text{見中分} = \text{歲數} \times 12$。而積中、中餘是見中分與見中法的商和餘數。見中法是行星早晨初見於東方，到下一次早晨初見於東方的週期，所以叫做見數（見應讀 xiàn，胡甸切），而見數的分母（法）就是見日法。從天文上來說，行星與太陽交會時，在地球上就看不到行星。但是看不到的次數和行星出現的次數是相同的。見閏分是歲數中所含的閏月數。十九年七閏，所以在歲數中的總閏月數就是：$\text{歲數} \times \frac{7}{19}$，$\text{見閏分} = \text{歲數} \times 7$。

\begin{align*}
&\frac{\text{見中分}}{\text{見中法}}\\\\
=&\text{積中}\frac{\text{中餘}}{\text{見中法}}\\\\
=&(\text{見中分} \ \mathbf{div}\ \text{見中法})\frac{\text{見中分} \ \mathbf{mod}\ \text{見中法}}{\text{見中法}}\\\\
\text{積中}=&\text{見中分} \ \mathbf{div}\ \text{見中法}\\\\
\text{中餘}=&\text{見中分} \ \mathbf{mod}\ \text{見中法}
\end{align*}

根據歲數、見數就可以算出一個見數中有多少個朔望月。將這個數化爲帶分數，分母叫做見月法，整數部分叫積月，分子叫月餘。

\begin{align*}
\text{歲數所含月數} &=\text{歲數} \times \text{一年月數}\\\\
&=\text{歲數} \times \frac{235}{19}\\\\
&=\frac{\text{歲數} \times 235}{19}\\\\
\text{見數所含月數}&=\text{歲數所含月數} \div \text{見中法}\\\\
&=\frac{\text{歲數} \times 235}{19} \div \text{見中法}\\\\
&=\frac{\text{歲數} \times 235}{19 \times \text{見中法}}\\\\
&=(\text{歲數} \times 235 \ \mathbf{div}\ (19 \times \text{見中法})) \frac{\text{歲數} \times 235 \ \mathbf{mod}\ (19 \times \text{見中法})}{19 \times \text{見中法}})\\\\
&=\text{積月} \frac{\text{月餘}}{\text{見月法}}\\\\
\text{見月法}&=19 \times \text{見中法}\\\\
\text{積月}&=\text{歲數} \times 235 \ \mathbf{div}\ (19 \times \text{見中法})\\\\
\text{月餘}&=\text{歲數} \times 235 \ \mathbf{mod}\ (19 \times \text{見中法})
\end{align*}

見月日法是見月法和日法（81）的積，即 $\text{見月法} \times \text{日法} = 81 \times \text{見月法}$，見中日法則是見月日法的三倍，即 $\text{見月日法} \times 3$。以上是所有行星都有的參數。

除了這幾個參數之外，金星還有晨中分、夕中分與積中、中餘，和晨閏分、夕閏分與積月、月餘十二個參數。原因在於金星和水星是內行星，它們的一個會合週期中包括一次晨見和一次夕見。這就可以算出一個晨見或夕見時段中中氣、閏月、月份的數量，分別化爲帶分數，就可以得出各自的積（這是積累的積，不是乘積的積）與小餘。

|紀母 |歲星      |太白      |鎮星       |熒惑       |辰星        | 公式 |
|:----------|:---------|:---------|:----------|:----------|:-----------|:-----------|
|小周       |12        |16        |30         |64         |64          |
|歲數       |1,728     |3,456     |4,320      |13,824     |9,216       |
|見中分     |20,736    |41,472    |51,840     |165,888    |110,592     | $\text{歲數} \times 12$ |
|積中       |13        |19        |12         |25         |3           |$\text{積中}\frac{\text{中餘}}{\text{見中法}}=\frac{\text{見中分}}{\text{見中法}}$ |
|中餘       |157       |413       |1,740      |4,163      |32,469      |
|見中法     |1,583     |2,161     |4,175      |6,469      |29,041      |
|見閏分     |12,096     |24,192    |30,240     |96,768     |64,512      | $\frac{\text{見閏分}}{\text{章歲}} = \frac{\text{歲數} \times 7}{19}$ |
|積月       |13        |19        |12         |26         |3           | $\text{積月}\frac{\text{月餘}}{\text{見月法}}=\frac{\text{歲數} \times 235}{\text{見月法}}$ |
|月餘       |15,079    |32,039    |63,300     |52,954     |510,423     |
|見月法     |30,077    |41,059    |79,325     |122,911    |551,779     | $\text{見月法} = 19 \times \text{見中法}$ |
|見中日法   |7,308,711 |9,977,337 |19,275,975 |29,867,373 |134,082,297 | $\text{見中日法} = 3 \times \text{見月日法} = 4617 \times \text{見中法} = \text{元法} \times \text{見中法}$ |
|見月日法   |2,436,237 |3,325,779 |6,425,325  |9,955,791  |44,694,099  |$\text{見月日法} = \text{見月法} \times \text{日法} = \text{見月法} \times 81$ |
|晨中分     |          |23,328    |           |           |62,208      |
|積中       |          |10        |           |           |2           |
|中餘       |          |1,718     |           |           |4,126       |
|夕中分     |          |18,144    |           |           |48,384      |
|積中       |          |8         |           |           |1           |
|中餘       |          |856       |           |           |19,343      |
|晨閏分     |          |13,608    |           |           |36,288      |
|積月       |          |11        |           |           |2           |
|月餘       |          |5,191     |           |           |114,682     |
|夕閏分     |          |10,584    |           |           |28,224      |
|積月       |          |8         |           |           |1           |
|月餘       |          |26,848    |           |           |395,741     |

其中水星的中餘應該是 23469，《律曆志》寫成了 32469，是錯的。

## 五步：五行運行軌跡表

五星雖然實際上一直不間斷地作繞日運動，但是在地球上的人看來，它們的軌跡則有時順、有時留，甚至有時逆行。五步就是記錄五星視運動軌跡的表格。外行星的運行軌跡經過六個階段：順、始留、逆、復留、復順、伏。五星運行以從西往東運動爲順行，而從東往西運動爲逆行；留是五星視位置停止不變，而伏則是行星距太陽太近，在地球上看不到。內行星的軌跡與外行星不同。內行星的視運動經過晨始見和夕始見兩個部分，每一部分經過五個階段：晨始見、逆、始留、順、順疾、伏；夕始見、順、順遲、始留、逆、伏。

: 外行星運動軌跡度數表

|            |木星     |        |土星        |               |火星              |                              |
|:-----------|:--------|:-------|:-----------|:--------------|:-----------------|:-----------------------------|
|運行軌跡    |日數     |日行度數       |日數         |日行度數  |日數          |日行度數                      |
|順行 |121      |$\frac{2}{11}$         |87         |$\frac{1}{15}$      |276   |$\frac{53}{92}$               |
|留   |25                        |0                   |34    |0    |10    |0                             |
|逆行 |84  |$\frac{1}{7}$               |101   |$\frac{5}{81}$                |62    |$\frac{17}{62}$               |
|留   |$24 \frac{3}{7308711}$       |0 |$33 \frac{862455}{19275975}$   |0    |10    |0                             |
|順行 |$111 \frac{1828362}{7308711}$|$\frac{2}{11}$        |85   |$\frac{1}{15}$  | 276          |$\frac{53}{92}$      |
|伏   |$33 \frac{3330737}{7308711}$ |$3 \frac{1673451}{7308711}$ |$37 \frac{17170170}{19275975}$ |$7 \frac{8736570}{19275975}$  |$146 \frac{15689700}{29867373}$|$114 \frac{8218005}{29867373}$|
|一見 |$398 \frac{5163012}{7308711}$|$33 \frac{3334737}{7308711}$|$377 \frac{18032625}{19275975}$|$12 \frac{13210500}{19275975}$|$780 \frac{15689700}{29867373}$|$415 \frac{8218005}{29867373}$|
|日行 |                     |$\frac{145}{1728}$ |    |$\frac{145}{4320}$ |$\frac{7355}{13824}$   |

: 內行星運動軌跡度數表

|            |金星                         |                             |水星                             |                               |                               |                              |
|:-----------|:----------------------------|:----------------------------|:--------------------------------|:------------------------------|:------------------------------|:-----------------------------|
|運行軌跡    |日數                         |日行度數                     |日數                             |日行度數                       |                               |                              |
|晨始見      |                             |                             |                                 |                               |                               |                              |
|逆行        |6                            |$\frac{1}{2}$                |1                                |2                              |                               |                              |
|始留        |8                            |0                            |2                                |0                              |                               |                              |
|順行        |46                           |$\frac{33}{46}$              |7                                |$\frac{6}{7}$                  |                               |                              |
|順行疾      |184                          |$1 \frac{15}{92}$            |18                               |$1 \frac{1}{3}$                |                               |                              |
|伏          |83                           |$1 \frac{33}{92}$            |$37 \frac{122029605}{134082297}$ |$1 \frac{7}{9}$                |                               |                              |
|晨見伏      |327                          |$357 \frac{4365220}{9977337}$|$65 \frac{122029605}{134082297}$ |$96 \frac{46610128}{134082297}$|                               |                              |
|夕始見      |                             |                             |                                 |                               |                               |                              |
|順行        |$181 \frac{45}{107}$         |$1 \frac{15}{92}$            |$16 \frac{1}{2}$                 |$1 \frac{1}{3}$                |                               |                              |
|順行遲      |46                           |$\frac{33}{46}$              |7                                |$\frac{6}{7}$                  |                               |                              |
|留          |$7 \frac{62}{107}$           |0                            |$1 \frac{1}{2}$                  |0                              |                               |                              |
|逆行        |6                            |$\frac{1}{2}$                |1                                |2                              |                               |                              |
|伏逆        |$16 \frac{1295352}{9977337}$ |$14 \frac{3069868}{9977337}$ |24                               |$6 \frac{58662820}{134082297}$ |                               |                              |
|夕見伏      |$257 \frac{1295353}{9977337}$|$226 \frac{6907649}{9977337}$|50                               |$19 \frac{15419477}{134082297}$|                               |                              |
|一復        |$584 \frac{1295353}{9977337}$|$584 \frac{1295352}{9977337}$|$115 \frac{122029605}{134082297}$|$\frac{122029605}{134082297}$  |                               |

## 表格

: 十二次初中終節氣度數表

|十二次   |初度數     |      |中度數       |      |終度數       |總度數         |
|:--------|:----------|:-----|:------------|:-----|:------------|:--------------|
|0 星紀   |初斗十二度 |大雪  |中牽牛初     |冬至  |終於婺女七度 |$30\frac{1}{4}$|
|1 玄枵   |初婺女八度 |小寒  |中危初       |大寒  |終於危十五度 |30             |
|2 諏訾   |初危十六度 |立春  |中營室十四度 |驚蟄  |終於奎四度   |31             |
|3 降婁   |初奎五度   |雨水  |中婁四度     |春分  |終於胃六度   |30             |
|4 大梁   |初胃七度   |穀雨  |中昴八度     |清明  |終於畢十一度 |30             |
|5 實沈   |初畢十二度 |立夏  |中井初       |小滿  |終於井十五度 |31             |
|6 鶉首   |初井十六度 |芒種  |中井三十一度 |夏至  |終於柳八度   |30             |
|7 鶉火   |初柳九度   |小暑  |中張三度     |大暑  |終於張十七度 |31             |
|8 鶉尾   |初張十八度 |立秋  |中翼十五度   |處暑  |終於軫十一度 |30             |
|9 壽星   |初軫十二度 |白露  |中角十度     |秋分  |終於氐四度   |31             |
|10 大火  |初氐五度   |寒露  |中房五度     |霜降  |終於尾九度   |30             |
|11 析木  |初尾十度   |立冬  |中箕七度     |小雪  |終於斗十一度 |31             |

: 二十四節氣表，從冬至開始。注意，三統曆驚蟄、雨水，清明、穀雨的順序和現在的順序正好相反。

|冬      |春      |夏      |秋      |
|:-------|:-------|:-------|:-------|
|21 立冬 |3 立春  |9 立夏  |15 立秋 |
|22 小雪 |4 驚蟄  |10 小滿 |16 處暑 |
|23 大雪 |5 雨水  |11 芒種 |17 白露 |
|0 冬至  |6 春分  |12 夏至 |18 秋分 |
|1 小寒  |7 穀雨  |13 小暑 |19 寒露 |
|2 大寒  |8 清明  |14 大暑 |20 霜降 |

: 二十八宿距度表

|東方七宿 |距度     |北方七宿 |距度     |西方七宿 |距度   |南方七宿 |距度       |
|:--------|:--------|:--------|:--------|:--------|:------|:--------|:----------|
|角       |十二     |斗       |二十六   |奎       |十六   |井       |三十三     |
|亢       |九       |牛       |八       |婁       |十二   |鬼       |四         |
|氐       |十五     |女       |十二     |胃       |十四   |柳       |十五       |
|房       |五       |虛       |十       |昴       |十一   |星       |七         |
|心       |五       |危       |十七     |畢       |十六   |張       |十八       |
|尾       |十八     |營室     |十六   |觜       |二     |翼       |十八       |
|箕       |十一     |壁       |九       |參       |九     |軫       |十七       |
|東       |七十五度 |北       |九十八度 |西       |八十度 |南       |百一十二度 |

上表周天總共 $$75 + 98 + 80 + 112 = 365$$ 度，沒有出現分數部分。按《淮南子·天文訓》，箕十一四分一，周天度數 $365 \frac{1}{4}$；《後漢書·律曆志》斗宿 $26 \frac{1}{4}$ 度，周天度數也是 $365 \frac{1}{4}$ 度。錢大昕認爲斗下脫“三百八十五分”。

曆法計算最基本的表格是六十干支表（或稱一甲數次表）。年月皆用干支來表示，六十一循環，往復無已。十天干、十二地支相互組合，可以形成週期爲六十的序列。下表是六十干支表，爲了便於計算，干支序數從 0 開始。

: 六十干支表（一甲數次表）

|       |        |         |        |         |        |
|:------|:-------|:--------|:-------|:--------|:-------|
|0 甲子 |10 甲戌 |20 甲申  |30 甲午 |40 甲辰  |50 甲寅 |
|1 乙丑 |11 乙亥 |21 乙酉  |31 乙未 |41 乙巳  |51 乙卯 |
|2 丙寅 |12 丙子 |22 丙戌  |32 丙申 |42 丙午  |52 丙辰 |
|3 丁卯 |13 丁丑 |23 丁亥  |33 丁酉 |43 丁未  |53 丁巳 |
|4 戊辰 |14 戊寅 |24 戊子  |34 戊戌 |44 戊申  |54 戊午 |
|5 己巳 |15 己卯 |25 己丑  |35 己亥 |45 己酉  |55 己未 |
|6 庚午 |16 庚辰 |26 庚寅  |36 庚子 |46 庚戌  |56 庚申 |
|7 辛未 |17 辛巳 |27 辛卯  |37 辛丑 |47 辛亥  |57 辛酉 |
|8 壬申 |18 壬午 |28 壬辰  |38 壬寅 |48 壬子  |58 壬戌 |
|9 癸酉 |19 癸未 |29 癸巳  |39 癸卯 |49 癸丑  |59 癸亥 |

## 數學術語與符號

古代所用的數學術語與今天不同。要想瞭解《律曆志》中的計算，要先弄清楚古代人用的數學術語的意思，也就是它們相當於今天所用的哪些數學術語。

在《律曆志》所用的數學術語中，最重要的是法和實兩個。古人與現在的人不同，數學計算是以分數進行的，而不是用小數。所有的小數都會化成分數進行計算。分數分爲分母和分子兩部分 $\frac{\text{分子}}{\text{分母}}$ 。古人把分母叫做法，分子叫做實，也就是：$\frac{\text{分子}}{\text{分母}} = \frac{\text{實}}{\text{法}}$。

在根據序數推求干支時，從甲子開始數，但是在數字上要從 0 開始，而不是 1 開始。《律曆志》將這種做法叫做“算外”。不止是在數甲子時候需要算外，數十二次等都需要這樣做。

在進行分數計算時，有些常用的運算，例如整數除法和餘數。整數除法用 $\ \mathbf{div}\ $，例如 $5 \ \mathbf{div}\ 2 = 2$；而餘數用 $\ \mathbf{mod}\ $，如 $5 \ \mathbf{mod}\ 2 = 1$。

| definition | math | notation |
| --------------- | --------------- | --------------- |
| least common multiple | $\mathbf{lcm}(2, 3) =6$ | $\mathbf{lcm}(2, 3)$ |
| integer division | $5\ \mathbf{div}\ 2 = 2$ | $\mathbf{div}$ |
| Modulus | $5\ \mathbf{mod}\ 2 = 1$ | $\mathbf{mod}$ |

# 《漢書·律曆志》筆記（3）：三統曆算法的基本思路

三統曆曆法計算分爲三個部分，第一部分是年月日、節氣、月食等的計算，叫做統術；第二部分是五大行星出現的時間等的計算，叫做紀術；第三部分是推求特定年份木星所在十二次的哪一次，叫做歲術。下面先解釋三統曆算法的基本思路，之後再依次介紹統術、紀術、歲術的計算方法。

上一個部分介紹了很多三統曆所用的週期、時間單位長度等等，這些對三統曆的曆法計算都很重要。三統曆對年月日以及月食、五星運行的計算都有一個基本的思路。

首先，假設一個定點，在這一點冬至出現在天正月朔日夜半，五星、日月都在同一個位置，也就是之前介紹的太極上元。這個定點就是所有事件（包括年月日、日月、五星運行）的起點。所有的推算都是以太極上元爲起點來計算的。

其次，所有的天文和曆法事件都有一個週期。在一個週期與另一個週期之內，同一個天文或曆法事件在週期內以相同的順序和時間發生。例如，前面說過，朔望月和回歸年有一個大約十九年，也就是 235 個月的週期。在十九年的週期之中，有七個閏月。十九年中的第一個閏月必定設置在第三年的九月之後，也就是閏九月。假設過了十九年之後，第二個週期開始，在第 22 年（第二個週期的第三年 $22=19 + 3$），也必然是閏九月。

基於這種思路，假設已經知道一個特定年份距離太極上元，也就是週期開始時的距離（三統曆叫做“距上元年數”），只要先除去已經過去的年份中所有完整的週期數，餘下的數就是該年份在一個週期中的所在的位置。例如，在計算一個特定年份有沒有閏月、閏月是哪個月時，假設已經知道本年距離上元 $22$ 年，在這 22 年中，有一個朔望月和回歸年的十九年週期，那本年就處在第二個的週期的第三年（$3 = 22 - 19 \times 1$）。

最後，根據給定年份在一個週期中的位置，與特定天文或曆法事件進行計算，就可以知道當年是否會發生這一天文或曆法事件，以及如果該事件發生，該事件發生的時間。例如，本年距上元 $22$ 年，在一個週期中處在第三年，根據十九年七閏，以及閏月必定在沒有中氣的月份的原則（這些已經在第一部分“中國傳統曆法的特點”中解釋過了），就可以確定本年有閏月，而且是閏九月。

總結一下，三統曆的計算大概有以下四步：

1. 給定一個年份距太極上元的年數 $n$
2. 已知某個事件的週期爲 $p$
3. 從太極上元到本年已經經過的週期數爲 $n \ \mathbf{div}\ p$，也就是 $n$ 除以 $p$ 的商。假如這個數字的單位是日，它就叫做“積日”；如果是月，就叫做“積月”，意思是該事件累積的週期數。而本年在本週期內的位置就是 $n \ \mathbf{mod}\ p$，就是 $n$ 除以 $p$ 的餘數。這個餘數叫做“小餘”。
4. 根據本年在本週期之內的位置 $n \ \mathbf{mod}\ p$，對照特定事件在一個週期內發生的順序，就可以知道本年該事件是否發生，以及如果發生，這一事件的發生時間。

還是以閏月爲例，假設一個特定年份距太極上元 $n$ 年，朔望月和回歸年的週期是 $p = 19$，計算過程就是：

\begin{align*}
n \div p& = \frac{n}{p}\\\\
& = n \ \mathbf{div}\ p \frac{n \ \mathbf{mod}\ p}{p}\\\\
& = n \ \mathbf{div}\ 19 \frac{n \ \mathbf{mod}\ 19}{19}\\\\
\text{到 n 年總共有幾個 19 年的週期}&= n \ \mathbf{div}\ 19\\\\
\text{第 n 年在 19 年的週期中的位置}&= n \ \mathbf{mod}\ 19\\\\
\end{align*}

知道了第 $n$ 年在 19 年的週期中的位置 $n \ \mathbf{mod}\ 19$，只要對照十九年的週期中設置閏月的順序和時間，就可以知道這一年有沒有閏月，以及閏月在哪一個月了。下面的表格就是十九年的週期中有閏月的年份，和閏月的月份。

| 年份   | 月份    |
|------- | ------- |
| 第 3 年   | 閏九月   |
| 第 6 年   | 閏六月   |
| 第 9 年   | 閏二月   |
| 第 11 年   | 閏十一月   |
| 第 14 年   | 閏七月   |
| 第 17 年   | 閏四月   |
| 第 19 年   | 閏十二月   |

將第 $n$ 年在 19 年的週期中的位置 $n \ \mathbf{mod}\ 19$與年份對照，如果這個數字是有閏月的年份，就知道這一年閏月的哪個月份。

三統曆對其他事件的計算都遵循相同的思路。假如一個事件在一個週期內發生的時間間隔是一樣的，例如一年二十四個節氣，每個節氣都是 $365 \frac{385}{1539} \div 24 = 15 \frac{8080}{1539 \times 24} = 15 \frac{1010}{4617}$。假如我們知道這一年冬至發生在 $j \frac{x}{1539}$ 日，那只要加上一個節氣的時間，就可以算出下一個節氣發生的時間，也就是：

\begin{align*}
&j \frac{x}{1539} + 15 \frac{1010}{4617}\\\\
=&j \frac{3x}{4617} + 15 \frac{1010}{4617}\\\\
=&(j + 15) \frac{3x + 1010}{4617}
\end{align*}

如果 $3x + 1010 > 4617$，那只要將這個數字化爲帶分數就可以知道下一個節氣發生的具體時刻了。三統曆對於節氣、中氣、五星後見的計算，都是基於這個思路的。

所以，要求某項事件是否發生和發生時間，只要知道三項數據就可以了：

1. 本年距上元年數；
2. 該事件的週期。這些週期數都已經列在統母、紀母中了；
3. 該事件在一個週期內的發生順序。有的事件是勻速發生的（節氣、中氣等），有的事件不是（閏月）。

但是要說明的是，太極上元是日月和五星運行的共同週期，在計算五星週期時，必須要用到太極上元。因爲五星會合週期大於日月會合週期 $138240 > 4617$ 。但是對於年月日的計算，只要知道特定年份在一元或一統之中的位置就可以了（元法 4617，統法 1539）。這也就是爲什麼統術第一項計算的就是距上元某年在哪一統哪一年的緣故。

# 《漢書·律曆志》筆記（4）：統術（附歲術）


統術是三統曆的基本曆法計算方法，可以用來計算一年在三統中的位置，該年天正月朔日的干支名稱（也就是日名）、冬至日和其他所有節氣的日名，以及本年是否需要置閏和在哪一個月置閏。除此之外，統術還包括計算天正月朔日日月所在星度、月食時刻等方法。三統曆以建子月，也就是夏正十一月爲曆法的起始，也是每年的第一個月，稱之爲天正。《律曆志》說：

> 其於三正也，黃鐘子為天正，林鐘未之衝丑為地正，太族寅為人正。

天正建子，以夏正十一月爲正月；地正建丑，以夏正十二月爲正月；人正建寅，以夏正正月爲正月。所以地正比天正晚一個月，人正比天正晚兩個月。但是除了在推天正、地正、人正中，一般都只以天正建子、夏正十一月爲一年的第一個月。所謂朔日，就是建子月的第一天。求閏月，也是從建子月開始。例如上一部分所舉的十九年一章中的第三年有閏九月，這個閏九月是從建子月，也就是夏正十一月開始數的。

統術各部分其實都是以已知數推求未知數的題目；所用數據有兩項，一項是常數，也就是統母中所列的數據，另一項是已知數，也就是由統術其他部分得出的結果。最基本的已知數其實只有一個數值，就是所求年距太極上元的年數，其他已知數都可以從該數求出。下表列出統術各項計算所用常數（統母）、已知數與所求數。其中太極上元以來年數爲 $x$，入統歲數爲 $n$。

|統術 |所用常數 |已知數 |所求數 |公式 |
|:----|:--------|:------|:------|:----|
|推日月元統 | 元法、統法 | 太極上元以來年數 | 統數，入統歲數 | $x \ \mathbf{mod}\ \text{元法}\ \mathbf{mod}\ \text{統法}$ |
|推天正 | 章月、章歲| 入統歲數| 積月、閏餘| $\text{積月} = n \times \text{章月} \ \mathbf{div}\ \text{章歲}$\ $\text{閏餘} = n \times \text{章月} \ \mathbf{mod}\ \text{章歲}$|
|推正月朔 | 月法、日法、統首日| 積月| 積日、小餘、朔日干支| $\text{積日}=\text{積月} \times \text{月法} \ \mathbf{div}\ \text{日法}$\ $\text{積日小餘}=\text{積月} \times \text{月法} \ \mathbf{mod}\ \text{日法}$\ $\text{積日大餘}=\text{積日} \ \mathbf{mod}\ \text{60}$|
|推閏餘 | 章中| 閏餘| 閏月 | $(\text{章中} - 12 \times \text{閏餘}) \ \mathbf{mod}\ 7 + 1$ |
|推冬至  | 策餘、統法、統首日| 入統年 | 冬至大餘、小餘、干支| $\text{大餘} = (\text{入統年} \times \text{策餘}) \ \mathbf{div}\ \text{統法}$\ $\text{小餘} = (\text{入統年} \times \text{策餘}) \ \mathbf{mod}\ \text{統法}$|
| 推合晨所在星| 統法、周天| 積日、積日小餘| 合晨度| $\text{合晨度} = (\text{積日} \times \text{統法} + 19 \times \text{小餘}) \ \mathbf{mod}\ \text{周天} \ \mathbf{div}\ \text{統法}$ \ $\text{合晨度小餘} = (\text{積日} \times \text{統法} + 19 \times \text{小餘}) \ \mathbf{mod}\ \text{周天} \ \mathbf{mod}\ \text{統法}$|
| 推其日夜半所在星| 章歲、統法| 月小餘（積日小餘）、合晨度| 日夜半星度| $\text{日夜半星度} =\text{合晨度} \frac{\text{合晨度小餘} - \text{積日小餘} \times \text{章歲}}{統法}$ |
| 推其月夜半所在星| 月周、統法| 月小餘（積日小餘）、合晨度| 月夜半星度| $\text{月夜半星度} =\text{合晨度} \frac{\text{合晨度小餘} - \text{積日小餘} \times \text{月周}}{統法}$|
| 推諸加時| | 小餘、各盈分母| 加辰| $\text{加時} = \frac{12 \times \text{小餘}}{分母}$|
| 推月食| 會月 | 積月 | 月食月 | $\text{會餘歲積月} = \text{積月} \ \mathbf{mod}\ \text{會月}$\ $\text{次餘} = \text{會餘歲積月} \times 23 \ \mathbf{mod}\ 135$ \ $\text{次餘} + 23 \times \text{月食月} \geq 135$|

下面這張圖展示了統術所用的已知數、統術所求的未知數，以及相互之間的關係。其中方框中的是統術的名稱，而橢圓中的是統術所用的已知數或所求的未知數。

![](/Users/chunyu/Documents/notes/topics/santongli/fig/tongshu.svg) 

統術部分只給出最終的公式計算方法，而略過了計算原理與中間步驟，爲求明晰，下面的解釋列出所有演算步驟。

## 推日月元統

> 推日月元統，置太極上元以來，外所求年，盈元法除之，餘不盈統者，則天統甲子以來年數也。盈統，除之，餘則地統甲辰以來年數也。又盈統，除之，餘則人統甲申以來年數也。各以其統首日為紀。

推日月元統是通過本年距上元年數計算出本年在三統中屬於第幾元第幾統第幾年。三統曆一元 4617 年，即元法；分一元爲天統甲子、地統甲辰、人統甲申，即三統，每統 1539 年。

假設本年距上元年數 $x$，則：

本年所在元數：$$x\ \mathbf{div}\ 4617$$
本年所在統數：$$x\ \mathbf{mod}\ 4617\ \mathbf{div}\ 1539$$
本年所在統數內年數：$$x\ \mathbf{mod}\ 4617\ \mathbf{mod}\ 1539$$

用 python 寫出來就是：

```
n % 4617 // 1539      # 本年所在統數，0 天統，1 地統，2 人統
n % 4617 % 1539       # 本年所在統數內年數
```

例如，伐紂之年距上元 142109 年，該年所在元數爲 $142109 \ \mathbf{div}\ 4617 = 30$，所在統數爲 $142109 \ \mathbf{mod}\ 4617 \ \mathbf{div}\ 1539 = 3$，也就是人統甲申；該年在人統年數爲 $142109 \ \mathbf{mod}\ 4617 \ \mathbf{mod}\ 1539 = 521$，也就是本年入人統甲申第 521 年。

## 推天正、地正、人正

> 推天正，以章月乘人[入]統歲數，盈章歲得一，名曰積月，不盈者名曰閏餘。閏餘十二以上，歲有閏。求地正，加積月一；求人正，加二。

根據入統年數計算天正、地正、人正。其實就是計算本年有沒有閏月。如果閏餘大於 12，本年就有閏月。三統曆一章 19 歲，一章總共 $19 \times 12 + 7 = 235$ 個月，每年 $235 \div 19 = \frac{235}{19} = 12 \frac{7}{19}$ 個月。假設入統年數爲 $n$，則該年積月 $n \times 12 \frac{7}{19}$，將這個數化爲帶分數，帶分數的分子部分稱之爲閏餘。如果該年閏餘大於 12，則本年需要置閏。寫成算式就是：

入統年數 $n$ 乘以一年月數，化爲帶分數：

$$
\begin{align*}
&n \times \frac{235}{19}\\\\
=& (n \times 235)\ \mathbf{div}\ 239 \frac{(n\times235)\ \mathbf{mod}\ 19}{19}
\tag{1.1}
\end{align*}
$$

寫成代碼就是：

```
n * 235 // 19         # 積月
n * 235 % 19          # 閏餘
```

由於天正以建子（十一月）爲一年起點，所以如果用的是地正建丑，以十二月爲一歲起點，那積月就要加一；而人正建寅，以正月爲起點，積月要加二。

已知伐紂之年爲人統甲申第 521 年，則本年積月 $521 \times 235 \ \mathbf{div}\ = 6443$ 月，閏餘 $521 \times 235 \ \mathbf{mod}\ 19 = 18$，閏餘大於 12，所以本年是閏年。

## 推正月朔、求其次月、求（正月）弦、望

> 推正月朔，以月法乘積月，盈日法得一，名曰積日，不盈者名曰小餘。小餘三十八以上，其月大。積日盈六十，除之，不盈者名曰大餘。數從統首日起，算外，則朔日也。\
> 求其次月，加大餘二十九，小餘四十三。小餘盈日法得一，從大餘，數除如法。求弦，加大餘七，小餘三十一。求望，倍弦。

這一段分爲兩部分。第一部分推正月朔是由已知年數的總月數（積月）求該年天正月朔日（建子月初一）的干支名稱。積月已經在上一部分推天正求出了。積月乘以一月日數 $29 \frac{43}{81}$，將這個數化爲帶分數，帶分數的整數部分就是積日，即入統以來總共有多少天。再將積日除以干支週期數 60，用所得小餘從統首日數起就是本年正月朔日所在干支。

上一部分已經算出積月，即 $n \times 235 \ \mathbf{div}\ 19$，設積月爲 $j$，這裏用積月算出積日和積日小餘，再用積日除以干支週期，所得餘數就是積日大餘。

\begin{align*}
\text{積月} \times \frac{\text{月法}}{\text{日法}} &=j \times \frac{2392}{81}\\\\
&= ((j \times 2392)\ \mathbf{div}\ 81) \frac{j \times 2392 \ \mathbf{mod}\ 81}{81}\\\\
&= \text{積日} \frac{\text{積日小餘}}{81}\\\\
\text{積日大餘}&=\text{積日}\ \mathbf{mod}\ 60
\end{align*}

寫成代碼就是：

```
# 入統第 n 年的積日，tongshouri 爲統首日干支，天統甲子，地統甲辰，人統甲申

def tuiZhengyueshuo(n, tongshouri):
    jiri = ((n * 235 // 19)
            * 2392).numerator // 81       # 入統第 n 年積日 
    jirixiaoyu = ((n * 235)// 19
            * 2392) % 81                  # 積日小餘
    jiridayu = jiri % 60                  # 積日大餘
    # 本年朔旦干支
    shuoriGanzhi = ganzhi[ganzhi.index(tongshouri) + jiridayu]
    return jiri, jirixiaoyu, shuoriGanzhi
```

伐紂入人統甲申 521 年，該年積日 190267 日，天正月朔日爲辛卯日。

第二部分，求其次月。因爲推正月朔已經求出當月的積日大餘與積日小餘，所以這裏再加上一個月的月長。如果本月的積月小餘加 43 大於 81，就說明下月大，次月大餘要加一；否則次月小。

\begin{align*}
\text{次月大餘} &=\text{積日大餘} + 29 + (\text{積日小餘} + 43)\ \mathbf{div}\ 81\\\\
\text{次月小餘} &=(\text{積日小餘} + 43)\ \mathbf{mod}\ 81
\end{align*}

自本月朔日到上弦日，爲一月的四分之一，也就是 $29 \frac{43}{81} \div 4 = 7 \frac{31}{81}$；而朔日到望日就是一月的一半，即 $29 \frac{43}{81} \div 2 = 14 \frac{62}{81}$。要求本月的弦或望只要用本月積日大小餘分別加上相應的弦望大小餘就可以了。

\begin{align*}
\text{弦日大餘}&=\text{積日大餘} + 7\\\\
\text{弦日小餘}&=\text{積日大餘} + 31\\\\
\text{望日大餘}&=\text{積日大餘} + 14\\\\
\text{望日小餘}&=\text{積日大餘} + 62
\end{align*}

## 推閏餘所在

> 推閏餘所在，以十二乘閏餘，加(十)[七]得一。盈章中，數所得，起冬至，算外，則中至終閏盈。中氣在朔若二日，則前月閏也。

這一段求所求年如有閏月，當置於哪月。在推天正部分已經求出本年的閏餘 $n \times 235 \ \mathbf{mod}\ 19$，閏餘如果大於 12，本年就要置閏。但是閏月置於哪個月呢？三統曆將閏月置於無中氣之月。

一年有二十四個節氣，其中十二個中氣。一年的長度以月份來計算就是 $12 \frac{7}{19}$ 個月，那一個中氣平均長度就是 $12 \frac{7}{19} \div 12 = 12 \frac{7}{19 \times 12}$ 個月。也就是說，每過一個月，中氣就過 $12 \frac{7}{19 \times 12} = \frac{235}{228}$。一個月的長度當然是 1，那者一個月過了之後，就會餘下 $\frac{235}{228} - 1 = \frac{7}{228}$ 個中氣。幾個月過去，中氣比一個月長的部分不斷累積，最終就會超過一個月的長度。當中氣和月長的差距超過一月時，下個月就沒有中氣，閏月就設置在這個月。 

上面推天正已經求出閏餘，閏餘以 19 爲分母。設閏餘爲 $u$，

\begin{align*}
\text{一月長}&=1\\\\
\text{一中氣長}&= \text{一年月長} \div \text{一年中氣數}\\\\
&=12 \frac{7}{19} \div 12\\\\
&= \frac{235}{228}\\\\
\text{中氣長}-\text{月長}&=\frac{235}{228} - 1\\\\
&=\frac{7}{228}\\\\
\text{m 月之後中氣剩餘}&= \frac{7m}{228}\\\\
\text{加上本年閏餘}\frac{u}{19}&=\frac{u}{19} + \frac{7m}{228}\\\\
&=\frac{12u + 7m}{228}\\\\
\text{當中氣累計剩餘超過}\ &228\ \text{時：}\\\\
12 u + 7m &\geq 228\\\\
\text{無中氣之月}&=(228 - 12 u)\ \mathbf{div}\ 7 + 1 \text{, 如果 } 12u + 7m > 228\\\\
&=(228 - 12 u)\ \mathbf{div}\ 7 \text{, 如果 } 12u + 7m = 228
\end{align*}

注意，這裏算出來的無中氣之月是自建子月數的，如果是 2，那就是建子月之後兩個月閏月，就是建寅月閏月。前面已經說過，十九年一章中設置閏月的順序和時間都是固定的。在上一部分“三統曆算法的基本思路”中，已經列出來一章閏月的順序，這裏再列一遍：

| 年份   | 月份    |
|------- | ------- |
| 第 3 年   | 閏九月   |
| 第 6 年   | 閏六月   |
| 第 9 年   | 閏二月   |
| 第 11 年   | 閏十一月   |
| 第 14 年   | 閏七月   |
| 第 17 年   | 閏四月   |
| 第 19 年   | 閏十二月   |

## 推冬至、八節、二十四氣

> 推冬至，以(算)[策]餘乘(人)[入]統歲數，盈統法得一，名曰大餘，不盈者名曰小餘。除數如法，則所求冬至日也。\
> 求八節，加大餘四十五，小餘千一百。求二十四氣，三其小餘，加大餘十五，小餘千一十。\
> 推中部二十四氣，皆以元為法。

這一段是根據入統年數求該年冬至日的干支。三統曆一年有 $365 \frac{385}{1539}$ 天，減去干支週期 60 的倍數 360，剩下 $5 \frac{385}{1539}$ 天，將這個數化爲帶分數 $\frac{8080}{1539}$，分子部分就是策餘。用策餘乘以入統歲數 $n$，以所得數除以統法，化爲帶分數，整數部分爲大餘[^dzdy]，分子部分爲小餘。再算出大餘除以干支週期 60 的餘數。從入統首日干支數起，就是冬至日的干支。寫成公式就是：

[^dzdy]: 這樣算出的冬至大餘並不能直接對應干支表中的序號，還需要加上統首日的干支序數。《〈漢書·律曆志〉研究》中將這樣算出來的冬至大餘再加統首日干支序數作爲冬至大餘，所以地統冬至大餘比這裏求出來的大 40 （地統甲辰干支序數 40），人統冬至大餘大 20 （人統甲申干支序數 20）。

策餘乘以入統歲數：

\begin{align*}
\frac{\text{策餘}}{\text{統法}} \times \text{入統歲數}&= \frac{8080}{1539} \times n\\\\
&= (n \times 8080 \ \mathbf{div}\ 1539) \frac{n \times 8080 \ \mathbf{mod}\ 1539}{1539} \\\\
&= \text{大餘} \frac{\text{小餘}}{1539}\\\\
\text{大餘}\ &=  n \times 8080 \ \mathbf{div}\ 1539\\\\
\text{小餘}\ &=  n \times 8080 \ \mathbf{mod}\ 1539\\\\
\end{align*}

大餘除以干支週期的餘數：

$$\text{干支序數} = \text{大餘} \ \mathbf{mod}\ 60 + \text{入統首日干支序數}$$

寫成代碼就是：

```
def tuiDongzhi(n, tongshouri):
    dongzhiDayu = n * 8080 // 1539
    dongzhiXiaoyu = n * 8080 % 1539
    dongzhiXushu = dongzhiDayu % 60
    dongzhiGanzhi = ganzhi[ganzhi.index(tongshouri) + dongzhiXushu]
    return dongzhiDayu, dongzhiXiaoyu, dongzhiGanzhi
```

伐紂之年入人統甲申 521 年，該年大餘爲 $521 \times 8080 \ \mathbf{div}\ 1539 = 2735$，大餘除以干支週期的餘數是 $2735 \ \mathbf{mod}\ 60 = 35$。從入統首日干支數起，甲申在干支表中的序數是 20，伐紂之年冬至干支的序數就是 $20 + 35 = 55$，也就是己未。這一年冬至是建子夏正十一月己未。

八節爲冬至、立春、春分、立夏、夏至、立秋、秋分、立冬。三統曆一年 $365 \frac{385}{1539}$ 日，每節平均長度爲 $365 \frac{385}{1539} \div 8 = 45 \frac{1010}{1539}$ 日。已知冬至大餘和冬至小餘，只要將它們分別加上每節長度就是八節各自的大餘和小餘。假設八節次序爲 $j$ （冬至爲 0），則第 $j$ 個八節的大餘、小餘可以用以下公式算出。

八節大餘：$$\text{冬至大餘} + 45 \times j$$
八節小餘：$$\text{冬至小餘} + 1010 \times j$$

而每個節氣的長度是 $365 \frac{385}{1539} \div 24 = 15 \frac{1010}{4617}$。假設二十四節氣次序爲 $i$ （冬至爲 0），則第 $i$ 個二十四節氣的大餘、小餘可以用以下公式算出。因爲小餘以 4617 爲分母，而上面算出的冬至小餘是以 1539 爲分母的，所以這裏要先將冬至小餘乘以 3。

二十四節氣大餘：$$\text{冬至大餘} + 15 \times i$$
二十四節氣小餘，以 $3 \times 1539 = 4617$ 爲分母（法）：$$\text{冬至小餘} \times 3 + 1010 \times i$$

## 推五行

> 推五行，其四行各七十三日，統(歲)[法]分之七十七。中央各十八日，統法分之四百四。冬至後，中央二十七日六百六分。

三統曆把一年的日子按照五行木、火、土、金、水分爲五個部分。但是五行所屬的日子並不是一個接着一個的，也就是說，並不是屬木的日子結束之後立馬跟着屬火的日子。三統曆是把木、火、金、水分別和春夏秋冬四季搭配，而四季當中各有一部分日子屬於土，這叫做“土王四季”。

一年 $365 \frac{385}{1539}$ 日，平均分爲五行，每行 $365 \frac{385}{1539} \div 5 = 73 \frac{77}{1539}$ 日；其中屬土的日子要分爲四份，分別歸入四季，因此土日每份爲 $73 \frac{77}{1539} \div 4 = 18 \frac{404}{1539}$ 日。也就是對於春夏秋冬四季，每一季的前 $73 \frac{77}{1539}$ 日屬於各自季節相對應的五行，而每一季的後 $18 \frac{404}{1539}$ 日屬於土。這樣加起來，正好是一年的日子。春夏秋冬分別從立春、立夏、立秋、立冬開始。畫成圖更好理解。

![](/Users/chunyu/Documents/notes/topics/santongli/fig/wuxing.png){width=35%}

圖裏面，每個季節最後一段就是屬土的日子。冬季一段還標出了冬至的位置，就是圖中藍色豎線的地方。《律曆志》說“冬至後，中央二十七日六百六分”的意思是從冬至到冬季屬中央土的日子還有 $27 \frac{606}{1539}$ 日。這是因爲冬至距離立春還有小寒、大寒，加上冬至總共三個節氣，根據上一個部分，推八節的部分，三個節氣之間相距 $45 \frac{1010}{1539}$ 日，再減去冬至與立春之間中央土日 $18 \frac{404}{1539}$ 日，就是 $27 \frac{606}{1539}$ 日。

## 推合晨所在星

> 推合晨所在星，置積日，以統法乘之，以十九乘小餘而并之。盈周天，除去之；不盈者，令盈統法得一度。數起牽牛，算外，則合晨所入星度也。

這一段是求入統年天正月朔日的日月合朔所在星度。《左傳·昭公七年》伯瑕說：“日月之會是謂辰”，所以合晨度（晨通辰）就是日月合朔時刻的星度。太陽每天運行一度，一年 $365 \frac{385}{1539} = \frac{562120}{1539}$ 日，也就是太陽運行一週的度數。562120 就是以統法爲分母的周天度數。所以只要算出自統首至入統年正月朔日總共有多少天，也就是積日和積日小餘（不足一日的部分），就可以算出日月合朔時所在星度。

積日和積日小餘已經在推正月朔部分求出。設積日爲 $j$，積日小餘爲 $y$，周天 562120，先求不盈周天度數，這就是日月運行不足一個週期的數值。

\begin{align*}
&\text{積日} \frac{小餘}{81} \div (365 \frac{385}{1539})\\\\
=& \frac{81 j + y}{81} \div (\frac{562120}{1539})\\\\
=& \frac{(81j+y) \times 1539}{81 \times 562120}\\\\
=& \frac{(81j+y) \times 19}{562120}\\\\
=& \frac{1539j+19y}{562120}\\\\
=& (1539j+19y) \ \mathbf{div}\ 562120)\frac{(1539j+19y) \ \mathbf{mod}\ 562120}{562120}\\\\
\text{不盈周天度數}=&(1539j+19y) \ \mathbf{mod}\ 562120
\end{align*}

不盈周天度數是日月運行不足一個週期的數值，但是還要求這個度數相當於一年 $365 \frac{385}{1539}$ 度數的多少度，所以要除以統法 1539。下面就是三統曆求合晨度的最終公式：

\begin{align*}
\text{合晨度}&=\text{不盈周天度數}\div 1539\\\\
&=((1539j+19y) \ \mathbf{mod}\ 562120)\ \mathbf{div}\ 1539\frac{((1539j+19y) \ \mathbf{mod}\ 562120)\ \mathbf{mod}\ 1539}{1539}
\end{align*}

由於三統曆的冬至點在牽牛初度，所以合晨度從牽牛初度起算。三統曆又說這裏還要“算外”，原因在於古人對度數的理解是一個區間，而不是如現代人一樣是一個點。因此，從牽牛初到牽牛一度之間就有一度，也就是牽牛初度是從 0 開始的。這其實不影響合晨度的計算，而對於利用合晨度計算最終所在星度，是要考慮到的。

寫成代碼：

```
def tuiHechen(jiri, xiaoyu):
    hechendu = (jiri * 1539 + xiaoyu * 19) % 562120 // 1539 + 1
    hechenXiaoyu = (dayu * 1539 + xiaoyu * 19) % 562120 % 1539
    return hechendu, hechenXiaoyu
```

## 推其日夜半所在星

> 推其日夜半所在星，以章歲乘月小餘，以減合晨度。小餘不足者，破全度。

由於日月合朔不一定在夜半，所以求朔日夜半星度需要以合晨度（也就是日月合朔度數）減去夜半，也就是積日小餘，這裏叫做月小餘[^yuexiaoyu]。合晨度和合晨度小餘上一部分已經求出。設合晨度爲 $c$，合晨度小餘爲 $z$，積日小餘爲 $y$：

[^yuexiaoyu]: 原因應該是這裏的積日小餘是根據積月算出來的，以 81 爲分母，而合晨度的分母是 1539，所以二者相減的時候，需要先通分：$81 \times 19 = 1539$，而積日小餘也要乘以章歲 19。

\begin{align*}
&\text{合晨度} \frac{\text{合晨度小餘}}{1539} - \frac{\text{積日小餘}}{81}\\\\
=&\text{c} \frac{z}{1539} - \frac{\text{y}\times 19}{1539}\\\\
=&\frac{1539c + z - 19c}{1539}\\\\
=&((1539c + z - 19c)\ \mathbf{div}\ 1539)\frac{(1539c + z - 19c)\ \mathbf{mod}\ 1539}{1539}
\end{align*}

## 推其月夜半所在星

> 推其月夜半所在星，以月周乘月小餘，盈統法得一度，以減合晨度。

正因爲夜半並不一定是日月合朔時刻，所以日月並不一定同度，所以算了夜半太陽所在星度，還可以算夜半月亮所在星度。與上一部分求日夜半所在星一樣，只要以日月合朔星度，也就是合晨度減去夜半之後月行度數，就是夜半月亮所在的星度。

一章十九年，月亮有 254 個恆星月。注意，這裏的恆星月與朔望月不同。朔望月是月相變化的週期，而恆星月則是月球相對於一顆遙遠恆星的自傳週期，與地球上的恆星年相當。一章有 254 個恆星月，那每個恆星月以日爲單位的長度就是：

\begin{align*}
&\text{一章日數} \div \text{一章恆星月總數}\\\\
=&\frac{562120}{81} \div 254\\\\
=& \frac{562120}{81 \times 254}
\end{align*}

周天總共 $\frac{562120}{1539}$ 度，所以月亮每日運行的度數就是：

\begin{align*}
&\text{周天度數} \div \text{一個恆星月日數}\\\\
=& \frac{562120}{1539} \div \frac{562120}{81 \times 254}\\\\
=& \frac{562120}{1539} \times \frac{81 \times 254}{562120}\\\\
=& \frac{81 \times 254}{1539}\\\\
=& \frac{254}{19}
\end{align*}

以恆星月而言，月亮一日行 $\frac{254}{19}$ 度。所以求月亮夜半星度只要以日月合晨度數減去不足一日月行的度數，也就是積日小餘與恆星月日行度數的積，就能得到月所在星度。設積日小餘爲 $y$，夜半月亮所在星度就是：

\begin{align*}
\text{月夜半所在星度} &=\text{合晨度} \frac{\text{合晨度小餘}}{1539} - (\frac{\text{積日小餘}}{81} \times \frac{254}{19} )\\\\
&=\text{c} \frac{z}{1539} - \frac{\text{y}\times 254}{1539}\\\\
&=\frac{1539c + z - 254y}{1539}\\\\
&=((1539c + z - 254y)\ \mathbf{div}\ 1539)\frac{(1539c + z - 254y)\ \mathbf{mod}\ 1539}{1539}
\end{align*}

## 推諸加時

> 推諸加時，以十二乘小餘為實，各盈分母為法，數起於子，算外，則所加辰也。

推諸加時的意思是以小餘計算各項數值在一天中的具體時刻。積日小餘是不足一日的部分，所以可以將積日小餘轉化成十二個時辰的時刻。三統曆將一日分爲十二時，所以將小餘乘以 12，化爲帶分數，整數部分就是時，而分數部分就是分。公式是：

\begin{align*}
\text{加時}&=\frac{12 \times \text{小餘}}{\text{各盈分母}}\\\\
&=(12 \times \text{小餘} \ \mathbf{div}\ \text{各盈分母}) \frac{12 \times \text{小餘} \ \mathbf{mod}\ \text{各盈分母}}{\text{各盈分母}}
\end{align*}

當然分數部分也能化爲六十進制的分秒。

## 推月食

> 推月食，置會餘歲積月，以二十三乘之，盈百三十五，除之。不盈者，加二十三得一月，盈百三十五，數所得，起其正，算外，則食月也。加時，在望日衝辰。

三統曆以 135 爲月食週期，135 個月會出現 23 次月食。但是一年平均 $12 \frac{7}{19} = \frac{235}{19}$ 個月，並不是 $\frac{135}{23}$ 的整數倍。所以需要算出 月食週期與回歸年長度的最小公倍數。月食週期 135 月，一年平均 $\frac{235}{19}$ 月，135 和 235 的最小公倍數是 6345。這個最小公倍數叫做**會月**。一個會月是 6345 月，相當於 27 章 513 年。與會月相當的年數叫做**會歲**。寫成算式就是：

\begin{align*}
\text{會月} &= \mathbf{lcm}(\text{朔望之會}, \text{章月})\\\\ 
&=\mathbf{lcm}(135, 235)\\\\
&=6345\\\\
\text{會歲}&=(6345 \div \text{章月}) \times \text{章歲}\\\\
&=6345 \div 235 \times 19\\\\
&=513
\end{align*}

下一步是求會餘歲積月。本年自統首以來的積月已經在推天正部分求出了。設積月爲 $j$，$j$ 除以會月的餘數，$j \ \mathbf{mod}\ 6345$，就是會餘歲積月。因爲 135 個月有 23 次月食，所以每隔 $\frac{135}{23}$ 就有一次月食。所以根據三統曆算法的基本思路，要先算出會餘歲積月經過了幾個月食，也就是以會餘歲積月除以一個月食的週期：

\begin{align*}
\text{會餘歲積月} &=\text{積月} \ \mathbf{mod}\ \text{會月}\\\\
&=j \ \mathbf{mod}\ 6345\\\\
&\text{會餘歲積月} \div \text{一個月食週期}\\\\
=&(j \ \mathbf{mod}\ 6345) \div \frac{135}{23}\\\\
=&(j \ \mathbf{mod}\ 6345) \times \frac{23}{135}\\\\
\text{食次}=&((j \ \mathbf{mod}\ 6345) \times 23) \ \mathbf{div}\ 135\\\\
\text{次餘}=&((j \ \mathbf{mod}\ 6345) \times 23) \ \mathbf{mod}\ 135\\\\
\end{align*}

食次爲會餘歲期間已經發生的日食數，而次餘就是本年天正月距離下一次月食的週期。假如次餘爲 0，則本年天正月就會發生月食。 而次餘與月食週期 135 的差值再除以 23 的商加一就是月食之月：

\begin{align*}
\text{當：次餘}+ 23 \times \text{月數} &\ge 135 \text{時，自天正月數相應月數就有月食}\\\\
\text{月食之月}&=(135-\text{次餘})\ \mathbf{div}\ 23 + 1
\end{align*}

## 歲術

> 推歲所在，置上元以來，外所求年，盈歲數，除去之，不盈者以百四十五乘之，以百四十四為法，如法得一，名曰積次，不盈者名曰次餘。積次盈十二，除去之，不盈者名曰定次。數從星紀起，算盡之外，則所在次也。欲知太歲，以六十除餘積次，餘不盈者，數從丙子起，算盡之外，則太歲日也。

推歲所在就是給定某年，求木星所在星次。木星的週期大約是十二年。春秋時就有用歲星所在星次來紀年的辦法。但是木星週期實際爲 11.86 年，所以三統曆發明了超辰法來計算歲星所在星次，並用來紀年。所謂超辰法，就是每過十二個木星週期，星次要往前進一個，跳過一個星次，所以叫做超辰法。設所求年距上元 $n$ 年，不盈歲數爲 $m$。

\begin{align*}
\text{歲星歲數}&= 144 \times 12\\\\
&=1728\\\\
\text{超辰}&=12 + 1 =13 \\\\
\text{不盈歲數}&=n \ \mathbf{mod}\  1728 = m\\\\
\text{積次} \frac{\text{次餘}}{144}&= m \times \frac{145}{144}\\\\
&=(145m \ \mathbf{div}\ 144) \frac{145n \ \mathbf{div}\ 144}{144}\\\\
\text{積次}&=145m \ \mathbf{div}\ 144\\\\
\text{次餘}&=145m \ \mathbf{mod}\ 144\\\\
\text{歲星所在星次}&=\text{積次}\ \mathbf{mod}\ 12\\\\
&=145m \ \mathbf{div}\ 144 \ \mathbf{mod}\ 12
\end{align*}

這一段還有求太歲的辦法，就是積次除以六十的餘數，再以丙子爲起點，數出對應的干支。

$$\text{太歲} = \text{積次} \ \mathbf{mod}\ 60$$

<!-- ## 推章首朔日、冬至日 -->
<!---->
<!-- > 推章首朔旦冬至日，置大餘三十九，小餘六十一，數除如法，各從其統首起。求其後章，當加大餘三十九，小餘六十一，各盡其八十一章。 -->
<!---->
<!-- 由三統曆基本時間單位年月日時長可知，一章日數 $\frac{562120}{81} = 6939 \frac{61}{81}$，積日除以干支週期六十的餘數就是 39：$6939 \ \mathbf{mod}\ 60 = 39$。也就是每過一章，就會在干支週期之外多出 39 天，加上小餘就是 $39 \frac{61}{81}$。所以，要求章首朔日干支，只要加上大餘、小餘，求六十的餘數就可以了。設章數爲 $k$，則第 $k$ 章的章首朔日冬至干支數就是： -->
<!---->
<!-- $$ -->
<!-- \begin{align*} -->
<!-- &(39 \times k) \frac{61 \times k}{81}\\\\ -->
<!-- =&(39 \times k + ((61 \times k) \ \mathbf{div}\ 81)) \frac{(61 \times 81) \ \mathbf{mod}\ 81}{81}\\\\ -->
<!-- &章首朔日冬至干支\\\\ -->
<!-- =&(39 \times k + (61 \times k)\ \mathbf{div}\ 81)) \ \mathbf{mod}\ 60  -->
<!-- \end{align*} -->
<!-- $$ -->

# 《漢書·律曆志》筆記（5）：紀術

![](/Users/chunyu/Documents/notes/topics/santongli/fig/planet.svg) 

行星與地球都是圍繞太陽運動的，而這種運動在地球上看來則是相當複雜的。上面這張圖是行星、地球、太陽之間相互位置的示意圖。中間橘色的點代表太陽，下面藍色的點代表地球；實線表示地球軌道，點線代表內行星（水星、金星）的軌道，虛線代表外行星（火星、木星、土星）的軌道。內行星水星、金星的軌道在地球與太陽之間。

當內行星運行到地球與太陽的連線或連線的延長線上時，也就是內行星與地球、太陽形成一條直線時，由於內行星靠近太陽，所以在地球上看不到內行星，這就叫做伏；而從內行星、地球、太陽三者位置的相對關係來說，如果內行星在遠離地球的一側，就叫上合，而當內行星在地球和太陽中間時，就叫下合。所謂大距，指的是地球上看起來，內行星距離太陽的距離最大的時候。當內行星在太陽東邊時，就叫東大距；在太陽西邊時，就叫西大距。西大距出現在早上，而東大距出現在傍晚。三統曆叫做晨見與夕見。因此在內行星的運行中，有兩次伏。一次是內行星運行到地球和太陽之間時，即下合時；另一次則是內行星運行到地球和太陽連線的延長線上時，即上合時。而對於外行星，由於外行星的軌道在地球之外，所以外行星會有兩次運行到地球和太陽連線的延長線上，一次靠近地球，另一次靠近太陽。靠近地球的那一次稱爲“衝”（opposition）。因爲這時行星正對着太陽，就如月亮在望日正對着太陽一樣，是最適於觀測外行星的時候。而在靠近太陽的那次，外行星就會被太陽的光芒掩蓋，地球上就看不到了。這就是外行星的伏；就行星、地球、太陽的位置關係而言叫“上合”（superior conjunction）。行星的這種運行是週期性的，例如外行星由一次上合到下一次上合是一個完整的週期。行星的這種運行週期就叫做一個會合週期（synodic cycle），在三統曆中叫做“一見”，這個週期的時長就叫見數，也就是紀母中的見中法。

紀術與統術不同。統術在推天地元統中算出入統年之後，其他計算只要用入統年就可以了，而所有的紀術計算都依賴於距太極上元年數。這是因爲太極上元是日月、五星的共同週期，要計算五星運行的時間，必須從太極上元算起。另外，紀術與統術不同，統術每個計算只要算一次，而紀術每種都可以算五次，每個行星一次（除了推晨見加夕，這一運算只有金星、水星能算）。

紀術部分從推五星見復到推入月日數，其實都是求一個事件的時間，就是星見。紀術分別計算了星見所在年份（推五星見復）、中氣、十二次（推星所見中次）、所在月份（推星見月）、所在中氣首日（推至日）、當月朔日（推朔日）、所在中氣日數（推入中）、所在月的第幾天（推入月日數）。除了推算本次星見時間外，還可以推算下一次星見時間，這就是推後見中（推算下一次星見所在中氣）、推後見月（推算下一次星見所在月份）的內容。

紀術部分所用的基本已知數也只有一個，就是太極上元以來年數，其他運算所用已知數都是從這個數值推算出來的。下圖展示了紀術各部分之間的關係與所用已知數。

![](/Users/chunyu/Documents/notes/topics/santongli/fig/jishu.svg) 

因爲紀術裏的用語有些與紀母不同，這裏稍加說明。紀母中的見中法，在紀術中叫做見復數，又叫做大統見復數。

| 紀術 | 紀母 | 已知數 | 所求數 | 公式 |
| --------------- | --------------- | --------------- | --------------- | --------------- |
| 推五星見復 | 見中法、歲數 | 距上元年數 | 見復數、見復餘、定見復數 | $\text{定見復數} = (\text{距上元年數} \times \text{見中法}) \ \mathbf{div}\ \text{歲數}$\ $\text{見復餘} = (\text{距上元年數} \times \text{見中法}) \ \mathbf{mod}\ \text{歲數}$ |
| 推星所見中次 | 見中法、見中分 | 定見復數 | 積中、中餘、中元餘、入章中數、星見中次 | $\text{積中} \frac{\text{中餘}}{\text{歲數}} = \frac{\text{定見復數} \times \text{見中分}}{\text{歲數}}$\ $\text{星見中次} = \text{積中}\ \mathbf{mod}\ \text{元中} \ \mathbf{mod}\ \text{章中}\ \mathbf{mod}\ 12$ |
| 推星見月 | 見閏分、見月法 | 定見復數、積中、中餘 | 積月、月餘、月元餘、入章月數、月 | $\text{積月} \frac{\text{月餘}}{\text{見月法}} = \frac{\text{見閏分} \times \text{定見復數} + \text{中餘} \times 19}{\text{見月法}} + \text{積中}$\ $\text{入章月數} = \text{積月}\ \mathbf{mod}\ \text{元月}\ \mathbf{mod}\ \text{章月}$ |
| 推至日 | | 中元餘 | 氣首日名 | $\text{積日}\frac{\text{小餘}}{\text{元法}} = \frac{\text{中元餘} \times \text{中法}}{\text{元法}}$\ $\text{氣首日名} = \text{積日}\ \mathbf{mod}\ 60$ |
| 推朔日 | | 月元餘 | 朔日 | $\text{積日}\frac{\text{小餘}}{81}=\frac{\text{月元餘}\times 2392}{81}$\ $\text{朔日}=\text{積日}\ \mathbf{mod}\ 60$ |
| 推入中次日度數 | 見中法、見中日法 | 中餘、積日小餘 | 入中 | $\text{入中}=\frac{\text{中餘}\times \text{中法} + \text{小餘}\times \text{見中法}}{\text{見中日法}}$ |
| 推入月日數 | 見月法、見月日法 | 月餘、朔日小餘 | 入月日 | $\text{入月日}=\frac{\text{月餘}\times \text{月法}+\text{小餘}\times \text{見月法}}{\text{見月日法}}$ |

## 推五星見復

> 推五星見復，置太極上元以來，盡所求年，乘大統見復數，盈歲數得一，則定見復數也。不盈者名曰見復餘。見復餘盈其見復數，一以上見在往年，倍一以上，又在前往年，不盈者在今年也。

所謂見復就是五星經過一個週期之後在天空中出現，而見復數就是五星出現的週期，也就是見中法，這裏叫做大統見復數。設所求年距太極上元年數爲 $x$，所求的行星歲數爲 $p$，行星見復數爲 $m$。

\begin{align*}
\text{一見復時間}&=\text{行星歲數} \div \text{見復數}\\\\
&=\frac{p}{m}\\\\
x\ \text{年見復數}&=x \div \frac{p}{m}\\\\
&=(xm \ \mathbf{div}\ p) \frac{xm \ \mathbf{mod}\ p}{p}\\\\
&=\text{定見復數} \frac{\text{見復餘}}{p}\\\\
\text{定見復數}&=xm \ \mathbf{div}\ p\\\\
&=(\text{距上元年數} \times \text{見復數}) \ \mathbf{div}\ \text{歲數}\\\\
\text{見復餘}&=xm \ \mathbf{mod}\ p\\\\
&=(\text{距上元年數} \times \text{見復數}) \ \mathbf{mod}\ \text{歲數}
\end{align*}

行星見復可以由見復餘與見復數的關係確定。假如見復餘大於見復數，但是小於見復數的兩倍，那行星見復就出現在所求年的前一年；而如果見復餘大於見復數的兩倍，但小於見復數的三倍，那行星見復就出現在所求年的前兩年。用代碼寫出來就是：

```
def tuiJianfu(x, jianfuShu, suiShu):
    """
    推五星見復：由距上元年數 x，求五星見復出現年數
    Args:
    x: 距上元年數
    jianfuShu: 見復數，即見中法
    suiShu: 歲數
    Returns:
    jianfu: 見復，1 在今年，2 在去年，3 在前年
    jianfuYu: 見復餘
    dingJianfu: 定見復數
    """
    dingJianfu = (x * jianfuShu) // suiShu
    jianfuYu = (x * jianfuShu) % suiShu
    if jianfuShu < jianfuShu:
       jianfu = 1           # 見復在本年
    elif jianfuShu >= jianfuShu and jianfuShu < 2 * jianfuShu:
       jianfu = -1           # 見復在去年
    elif jianfuShu >= 2 * jianfuShu and jianfuShu < 3 * jianfuShu:
       jianfu = -2           # 見復在前年
    return jianfu, jianfuYu, dingJianfu
```

## 推星所見中次

> 推星所(一多“在”字)見中次，以見中分乘定見復數，盈見中法得一，則積中法也。不盈者名曰中餘。以元中除積中，餘則中元餘也。以章中除之，餘則入章中數也。以十二除之，餘則星見中次也。中數從冬至起，次數從星紀起，算外，則星所見中次也。

這一條是求行星出現時刻在當年的哪個中氣內，與出現在十二次的哪一次。具體計算步驟是：

1. 計算出上元以來的所有中氣數：$\text{定見復數} \times \frac{\text{見中分}}{\text{見中法}} = \text{積中} \frac{\text{中餘}}{\text{見中法}}$
2. 計算出中元餘，也就是不足一個元中的中氣餘數：$\text{中元餘} =\text{積中} \ \mathbf{mod}\  \text{元中}$。這裏要用到一元的中氣數 55404，即統母中的元中。
3. 計算出入章中數，也就是不足一個章中的中氣餘數：$\text{入章中數}=\text{中元餘} \ \mathbf{mod}\  \text{章中}$。章中是一章的中氣數，也見統母。
4. 計算出星見中次，也就是五星見在十二次的哪一次：$\text{星見中次} \text{入章中數} \ \mathbf{mod}\ 12$
5. 以所得星見中次，從冬至開始數，就是星所見中氣；從星紀開始數，就是星所見次。注意，仍然是以冬至/星紀爲 0 開始數。

設距上元年數爲 $x$，見復數（見中法）爲 $m$，歲數爲 $p$，定見復數爲 $d$。計算出上元以來的所有中氣數，也就是定見復數內總中氣數，將它轉換成帶分數，就可以算出積中、中餘：

\begin{align*}
\text{定見復數}&=(\text{距上元年數} \times \text{見復數}) \ \mathbf{div}\ \text{歲數})\\\\
&= xm \ \mathbf{mod}\ p\\\\
\text{一見復數年數}&=\frac{\text{歲數}}{\text{見復數}}\\\\
&=\frac{p}{m}\\\\
\text{定見復數年數}&=\text{定見復數} \times \text{一見復數年數}\\\\
&=\text{定見復數}\times \frac{\text{歲數}}{\text{見復數}}\\\\
&=\text{d} \times \frac{p}{m}\\\\
\text{一年中氣數}&=12\\\\
\text{歲數} \times 12 &= \text{見中分}\\\\
\text{定見復數總中氣數}&=\text{定見復數總年數} \times \text{一年中氣數}\\\\
&=\text{d} \times \frac{p}{m} \times 12\\\\
&=\text{d} \times \frac{\text{見中分}}{m}\\\\
&=(d \times \text{見中分} \ \mathbf{div}\ m) \frac{d \times \text{見中分} \ \mathbf{mod}\ m}{m}\\\\
&=\text{積中} \frac{\text{中餘}}{m}\\\\
\text{積中}&=d \times \text{見中分} \ \mathbf{div}\ m\\\\
\text{中餘}&=d \times \text{見中分} \ \mathbf{mod}\ m
\end{align*}

要求星見中次，只要以積中除元中、章中、十二次/氣，求得各自的餘數就可以了。也就是：

$$
\begin{align*}
\text{中元餘}&=\text{積中} \ \mathbf{mod}\ \text{元中}\\\\
&=\text{積中} \ \mathbf{mod}\ 55404\\\\
\text{入章中數}&=\text{中元餘}\ \mathbf{mod}\ \text{章中}\\\\
&=\text{中元餘} \ \mathbf{mod}\ 228\\\\
\text{星見中次}&=\text{入章中數} \ \mathbf{mod}\ 12
\end{align*}

## 推星見月

> 推星見月，以閏分乘定見，以章歲乘中餘從之，盈見月法得一，并積中，則積月也。不盈者名曰月中餘。以元月除積月餘，名曰月元餘。以章月除月元餘，則入章月數也。以十二除之，至有閏之歲，除十三。[^rz]入章三歲一閏，六歲二閏，九歲三閏，十一歲四閏，十四歲五閏，十七歲六閏，十九歲七閏。不盈者數起於天正，算外，則星所見月也。

[^rz]: 劉洪濤認爲應該在十三後點斷，是。

上一段已經求得行星始見所在中氣和十二次，這一段則是求新會合週期開始時星始見的月份。三統曆用了三個步驟：

1. 求定見復數期間總月數
2. 根據積月求出星見在本章的哪月
3. 減去本章不計閏月的月數（每年十二）、閏月數（入章三年一個閏月，六年兩個，九年三個，十一年四個，十四年五個，十七年六個，十九年七個），算出星見在本年的哪個月

首先求定見復數期間所有的朔望月數目。三統曆將朔望月分爲閏月和一般的一年十二個月。所以要求定見復數期間所有的朔望月數目，只要將定見復數期間所有閏月和定見復數期間所有 12 個月（非閏月）加起來就可以了。根據紀母部分的見閏分（這裏叫做閏分），一個會合週期，也就是歲數中有 $\text{見閏分} = \text{歲數} \times \frac{7}{19}$ 個閏月，而一見的閏月數就是：$\frac{\text{歲數} \times 7}{\text{見中法} \times 19}$。一年的非閏月數與中氣數一樣，都是 12，所以定見復數期間所有的不含閏月的朔望月數目與這期間所有的中氣數是一樣的。上一部分“推星所見中次”已經求出定見復數期間的積中和中餘了，將這個數字加上閏月數就是定見復數期間所有朔望月數目。寫成算式就是：

\begin{align*}
\text{定見復數總閏月數}&=\frac{\text{閏分}}{\text{見月法}} \times \text{定見復數}\\\\
\text{定見復數不計閏月總月數} &=\text{定見復數總中氣數}\\\\
&=\text{積中} \frac{\text{中餘}}{\text{見中法}}\\\\
\text{定見復數總月數}&=\text{定見復數總閏月數} + \text{定見復數不計閏月總月數}\\\\
&=\frac{\text{閏分} \times \text{定見復數}}{\text{見月法}} + \text{積中} \frac{\text{中餘}}{\text{見中法}}\\\\
&=\frac{\text{閏分} \times \text{定見復數} + \text{中餘} \times 19}{\text{見月法}} + \text{積中}& \text{見月法} = 19 \times \text{見中法}\\\\
&= \text{積月} \frac{\text{月餘}}{\text{見月法}}
\end{align*}

與上一部分“推星所見中次”一樣，先要將積月除以元月、章月，求出月元餘、入章月數。由於在一章中有些年份有閏月有些年份沒有，並不是每年都是十二個月，所以求出了入章月數，並不能立即得出該月在一章之中的哪年、哪個月，還需要從入章月中減去累積的月數，這都要按照統術部分“推閏餘”所列出的表格來。每逢一章中的第 3、6 、9、11、14、17、19 年，就要減去十三個月，再根據不足一年的月數求出星見在本年的哪月。

\begin{align*}
\text{月元餘}&=\text{積月} \ \mathbf{mod}\ \text{元月}\\\\
&=\text{積月} \ \mathbf{mod}\ 57105\\\\
\text{入章月數}&=\text{月元餘} \ \mathbf{mod}\ \text{章月}\\\\
&=\text{積月} \ \mathbf{mod}\ 57105 \ \mathbf{mod}\ 235\\\\
\end{align*}

## 推至日

> 推至日，以中法乘中元餘，盈元法得一，名曰積日，不盈者名曰小餘。小餘盈二千五百九十七以上，中大。數除積日如法，算外，則冬至也。

這一段以“推至日”爲名，從字面上看應該是求冬至日的干支日名，但是從所述算法來看，實際是求星見所在中氣的干支日名。《中國古代曆法》認爲“推至日”應該是“推中日”之誤。這裏仍用推至日的名字，但是所求未知數是星見所在中氣的干支日名。這裏要用到的已知數是“推星所見中次”中求出的中元餘。

在“推星所見中次”中已經求出從上元到星見期間累積的中氣數，而中元餘就是星見所在元中累積的中氣數。在“三統曆基本時間單位”中已經求出一個中氣的時間長度是 $30 \frac{2020}{4617} = \frac{140530}{4617}=\frac{\text{中法}}{元法}$，那將中元餘乘以一個中氣的長度就是在當前元中到星見所在中氣時累積日數，也就是：

\begin{align*}
\text{入元來到當前中氣日數}&=\frac{\text{中元餘} \times \text{中法}}{\text{元法}}\\\\
&=\text{積日}\frac{\text{小餘}}{\text{元法}}\\\\
\text{氣首日名}&=\text{積日} \ \mathbf{mod}\ 60
\end{align*}

而求當前中氣所在日期的干支日名就是求積日大餘，並在干支表中數出對應干支即可。

## 推朔日

> 推朔日，以月法乘月元餘，盈日法得一，名曰積日，餘名曰小餘。小餘三十八以上，月大。數除積日如法，算外，則星見月朔日也。

這一段是求星見之月的朔日干支，所用已知數是“推星見月”中求出的月元餘，也就是入元以來的月數。月元餘乘以一月日數 $\frac{2392}{81} = \frac{\text{月法}}{\text{日法}}$ 就是從入元以來到星見月的所有日數。再以積日求出積日大餘就知道當月朔日的干支日名了。

\begin{align*}
&\text{月元餘} \times \frac{\text{月法}}{\text{日法}}\\\\
=&\text{月元餘} \times \frac{2392}{81}\\\\
=&\text{積日}\frac{\text{小餘}}{81}\\\\
\text{朔日}&=\text{積日} \ \mathbf{mod}\ 60
\end{align*}

## 推入中、次日度數

> 推入中次日度數，以中法乘中餘，以見中法乘其小餘并之，盈見中日法得一，則入中日入次度數也。中次至日數，次以次初數，算外，則星所見及日所在度數也。求夕，在日後十五度。

求星見所入中氣之後的日數，以及星見在所入十二次的度數。在推星所在中次部分，以及算出星見時刻不足一個中氣的時長是 $\frac{\text{中餘}}{\text{見中法}}$。要求星見所入中氣之後的日數，只要將這個數值轉換成日數就可以了，也就是將這個數值乘以一個中氣的日數（參見表格：三統曆基本時間單位年月日時長）：

$$\frac{\text{中餘}}{\text{見中法}}\times \frac{\text{中法}}{\text{元法}}$$

但是星見所在中氣並非一定在夜半，所以將這個數值轉換成日數之後，還需要加上星見所在中氣距夜半的時段。這個時段已經在推至日部分算出來了，也就是入元來日數除去積日的分數部分，即 $\frac{\text{小餘}}{\text{元法}}$。上一個數值與這個數值相加，就是：

\begin{align*}
&\frac{\text{中餘}}{\text{見中法}}\times \frac{\text{中法}}{\text{元法}} + \frac{\text{小餘}}{\text{元法}}\\\\
=&\frac{\text{中餘} \times \text{中法} + \text{小餘} \times \text{見中法}}{\text{見中法} \times \text{元法}}\\\\
=&\frac{\text{中餘} \times \text{中法} + \text{小餘} \times \text{見中法}}{\text{見中日法}}
\end{align*}

其中，見中日法 $= \text{見中法} \times \text{元法}$，參見紀母表。將這個數字化爲帶分數，假如整數部分是 0，那星見就中氣首日，也就是中氣當天。

## 推入月日數

> 推入月日數，以月法乘月餘，以見月法乘其小餘并之，盈見月日法得一，則入月日數也。并之大餘，數除如法，則見日也。

這一段是求星見在所在月的日數，所用的已知數是“推星見月”中求出的月餘、“推朔日”中求出的積日小餘。以月餘乘以一月日數 $\frac{2392}{81} = \frac{\text{月法}}{\text{日法}}$，再加上朔日小餘就是星見當日的日數。

\begin{align*}
&\frac{\text{月餘}}{\text{見月法}} \times \frac{\text{月法}}{81} + \frac{\text{小餘}}{81}\\\\
=&\frac{\text{月餘}}{\text{見月法}}\times \frac{\text{月法}}{81} + \frac{\text{小餘} \times \text{見月法}}{81 \times \text{見月法}}\\\\
=&\frac{\text{月餘} \times \text{月法} + \text{小餘} \times \text{見月法}}{81 \times \text{見月法}}\\\\
=&\frac{\text{月餘} \times \text{月法} + \text{小餘} \times \text{見月法}}{\text{見月日法}}
\end{align*}

將求得的數化爲帶分數，再加上朔日大餘，就是星見當天的干支日名了。如果二者加起來超過 60，求二者之和除以 60 的餘數，也就是星見日大餘，就可以求得當天的干支序數了。

## 推後見中、後見月

> 推後見中，加積中於中元餘，加後餘於中餘，盈其法得一，從中元餘，數如法，則見也。

這一段是計算下一次星見所在的中氣。本次星見的積中和中餘已經在推星所見中次中求得，那下一次星見所在中氣只要加上一見所含中氣的積中和中餘就可以得到了。星見一次所含中氣次數爲 $\frac{\text{見中分}}{\text{見中法}} = \text{積中} \frac{\text{中餘}}{\text{見中法}}$。爲了區分本次星見的積中和中餘與一見的積中和中餘，《中國古代曆法》中將一見的積中和中餘叫做見中和見中餘。也就是說，下次星見所在的中氣數爲：

\begin{align*}
&\text{本次星見積中中餘} + \text{一見的積中和中餘}\\\\
=&\text{積中}\frac{\text{中餘}}{\text{見中法}} + \text{見中} \frac{\text{見中餘}}{\text{見中法}}\\\\
\end{align*}

要求下一次星見中次，只要以求得的下一次積中除元中、章中、十二次/氣，求得各自的餘數就可以了。

> 推後見月，加積月於月元餘，加後月餘於月餘，盈其法得一，從月元餘，除數如法，則後見月也。

推下一次星見所在的月份，與推後見中一樣，以推星見月部分求出的月元餘、月餘加上一見的積月、月餘（紀母中的積月和月餘，《中國古代曆法》稱之爲見月、見月餘），以求得下一次星見的積月、月餘，按照推星見月後半部分的計算，就可以求得下一次星見所在月份了。也就是：

\begin{align*}
&\text{本次星見積月月餘} + \text{一見的積月和月餘}\\\\
=&\text{月元餘}\frac{\text{月餘}}{\text{見月法}} + \text{見月} \frac{\text{見月餘}}{\text{見月法}}\\\\
=&(\text{月元餘} + \text{見月}) \frac{\text{月餘} + \text{見月餘}}{\text{見月法}}
\end{align*}

> 推至日及入中次度數，如上法。\
> 推朔日及入月數，如上法。\
> 推晨見加夕，夕見加晨，皆如上法。\

要計算下一次星見的至日、入中次度數、朔日與入月數，只要加上五星一見的積中、中餘、積月、月餘就可以了。而計算金星、水星的晨見、夕見，也只要加上晨見或夕見的積中、中餘、積月、月餘。

## 推五步

> 推五步，置始見以來日數，至所求日，各以其行度數乘之。其星若日有分者，分子乘全為實，分母為法。其兩有分者，分母分度數乘全，分子從之，令相乘為實，分母相乘為法，實如法得一，名曰積度。數起星初見星宿所在宿度，算外，則星所在宿度也。

求星見之後某天星所在宿度。在紀母之後的五步部分，三統曆已經給出了五大行星的運行軌跡和運行不同階段的日數與日行度數。因此，只要知道了五星始見的位置，也就是星度，就是上面“推入中次日度數”部分所求出十二次度數，再對照五大行星在各個階段停留的日數與日行度數，就可以算出相應時間行星所在的位置。這裏所說的只是整數相乘、整數與分數相乘、分數與分數相乘的辦法，而沒有解釋推五步的具體辦法。

# 《漢書·律曆志》筆記（6）：世經

這一部分用上面總結的三統曆算法驗算世經。這裏有幾點要提前說明：

1. 世經所記載的距上元年數不一致。在計算時有時需要算外減一，有時不需要。這裏用的辦法是：以距上元歲數來紀年，紀年從 0 開始；如果所求年份在伐紂克殷 142109 之後、漢高祖元年 143025 以前，距上元年數就要算外減一，其餘年份則不用。具體理由見下面“世經所記距上元年數”部分。
2. 世經所記與所引證的經傳有的與三統曆相合，有的不合，但是不合的是極少數，例如所引《武成》“粵若來三月”與世經所列日名不合，見“武王伐紂日名”一段。又如所引《畢命》康王十二年“六月庚午朏”，三統曆推算出是八月庚午朏（見“其他日名”一段）。 

## 世經所記時段

世經是劉歆以三統曆排定的東漢以前年表。從五帝到夏朝，都沒有年數。世經中可考的最早年數從商湯伐桀開始，伐桀之年距上元 141480 歲，歲在大火房五度。伐桀到伐紂克殷之年之間，只有成湯崩年（即太甲元年）有歲數。從伐桀到武王伐紂克殷距上元 142109 年，總共 629 年。

武王伐紂到周康王十六年之間，用周王紀年。周昭王以後，周王年數無可考，所以從周康王十六年，伯禽薨開始到魯頃公十八年，以魯公在位年數紀年。此後到漢高祖元年（距上元 143025 年）之前，以秦王紀年。漢高祖之後到光武帝，都用漢代紀年。世經對其中這些時段的年數有明確記載，如下表：

| 時段 | 年數 | 始年 | 終年 |
| ---- | ---- | ---- | ---- |
| 伐桀到伐紂 | 629 | 141480 | 142109 |
| 伐紂到春秋隱公元年 | 400 | 142109 | 142509 |
| 伯禽至春秋 | 386 | 142123 | 142509 |
| 自春秋隱公元年到哀十四年 | 242 | 142509 | 142751 |
| 周凡三十六王 | 867 | 142109 | 142976 |
| 秦伯五世 | 49 | 142976 | 143025 |
| 自漢元年訖更始二年 | 230 | 143025 | 143254 |

上表中還標了每個時段的起始和終止年份，都以距上元歲數來表示。其中漢元年到更始二年其實是 $143254-143025 = 229$年，合理的解釋是包含漢元年在內的，所以加一年正好是 230。對距上元年數的討論見下一部分。

世經所記魯公在位年數與《史記·魯周公世家》《十二諸侯年表》有不一樣的地方，如下表[^lu]。

[^lu]: 《十二諸侯年表》只到春秋終，即哀公十七年，並說哀公總共 27 年。哀公以下年數見《六國年表》。

| 魯公         | 世經 | 魯周公世家 |十二諸侯年表 |
|:-------------|:-----|:-----------|:------------|
| 伯禽         |46    |無          |             |
| 考公         |4     |4           |             |
| 煬公         |**60** |6           |             |
| 幽公         |14    |14          |             |
| 微公         |50    |50          |             |
| 厲公         |37    |37          |             |
| 獻公         |**50** |32          |             |
| 慎（真）公   |30    |30          |30           |
| 武公         |**2** |9           |10           |
| 懿公         |9     |9           |9            |
| 柏（伯）御   |11    |11          |             |
| 孝公         |27    |27          |38（通伯御） |
| 惠公         |46    |46          |46           |
| 隱公         |11    |11          |11           |
| 桓公         |18    |18          |18           |
| 莊公         |32    |32          |32           |
| 愍公         |2     |2           |2            |
| 釐公         |33    |33          |33           |
| 文公興       |18    |18          |18           |
| 宣公俀       |18    |18          |18           |
| 成公黑肱     |18    |18          |18           |
| 襄公午       |31    |31          |31           |
| 昭公裯       |32    |32          |32           |
| 定公宋       |15    |15          |15           |
| 哀公將       |27    |27          |27           |
| 悼公寧       |37    |37          |37           |
| 元公嘉       |21    |21          |20           |
| 穆公顯       |33    |33          |30           |
| 恭公奮       |22    |22          |23           |
| 康公屯       |9     |9           |8            |
| 景公匽       |29    |29          |28           |
| 平公叔       |20    |22          |18           |
| 緡（文）公賈 |23    |23          |22           |
| 頃公讎       |24    |24          |23           |

## 世經所記距上元年數

距上元年數是世經的基礎，所有數據以及年代安排都必須以此爲基礎。但是世經所記距上元年數有不一致的地方。不說明這一點，對世經的驗算就會遇到困難。首先要說明的是，三統曆的起點，也就是太極上元，起算點是 0 而不是 1。當計算三統曆開始的第一年的朔日、冬至、歲次等等數據時，第一年的距上元歲數是 0 而不是 1。以距上元歲數來紀年，有兩種可能的做法。第一種就是從 0 年開始，這樣在根據三統曆計算時，只需要以紀年歲數計算就可以。另一種是從 1 年開始，與公元紀年從 1 年開始，沒有 0 年。如果用這種辦法來紀年，那在計算時，就要先將紀年的數字減去 1，再進行計算。下面的表格就表示來這兩種不同做法。下面我們會發現，世經本書對距上元年數的用法就不一致。在整理世經年曆時，要保持與世經距上元歲數的一致，必須要對歲數作出適當調整。這一部分就詳細討論世經紀年的不一致之處，以及這裏所用的調整的辦法。

| 紀年法 | 距上元元年 | 三統曆計算所用數值 |
| ------ | ---------- | --------------- |
| 從 0 年開始 | 0 | 0 |
| 從 1 年開始 | 1 | $1 - 1 = 0$ |

世經明確指出距上元年數有以下五處：

- 141480: “上元至伐桀之歲，十四萬一千四百八十歲，歲在大火房五度。”
- 142109: “上元至伐紂之歲，十四萬二千一百九歲，歲在鶉火張十三度。”
- 142577: “釐公五年正月辛亥朔旦冬至，殷曆以為壬子，距成公七十六歲。是歲距上元十四萬二千五百七十七歲，得孟統五十三章首。”
- 143025: “漢高祖皇帝，著紀，伐秦繼周。木生火，故為火德。天下號曰漢。距上元年十四萬三千二十五歲，歲在大棣之東井二十二度，鶉首之六度也。故漢志曰歲在大棣，名曰敦牂，太歲在午。”
- 143127: “漢曆太初元年，距上元十四萬三千一百二十七歲。前十一月甲子朔旦冬至，歲在星紀婺女六度，故漢志曰歲名困敦，正月歲星出婺女。”

以這五個數字計算當年朔日、冬至干支，如下表：

| 距上元年數 | 統 | 入統歲數 | 朔日干支 | 冬至干支 | 歲次 | 歲所在宿 | 歲入宿度 |
|:--------:|:----:|:------:|:------:|:------:|:--:|:--:|:--:|
| 141480 | 地統甲辰 | 1431 | 庚戌 | 丙辰 | 大火 | 房 | 5 |
| 142109 | 人統甲申 | 521 | 辛卯 | 己未 | 鶉火 | 張 | 13 |
| 142576 | 人統甲申 | 988 | 辛亥 | 辛亥 | 大火 | 氐 | 8 |
| 142577 | 人統甲申 | 989 | **乙巳** | **丙辰** | **析木** | 尾 | 13 |
| 143025 | 人統甲申 | 1437 | 丙辰 | 戊辰 | 鶉首 | 井 | 22 |
| 143127 | 天統甲子 | 0 | 甲子 | 甲子 | 星紀 | 女 | 6 |

可見，釐公五年距上元 142577，算出來的朔日、冬至干支與世經所載不同；而將這個年數算外減一卻能得出對的結果，但是其他年數則不用減一，就可以得出正確的朔日、冬至干支。可見世經本身體例就不一致[^xigong]。

[^xigong]: 劉操南在《古代天文曆法釋證》裏說釐公五年：“言距算外所求年，當作 142576”，意思恐怕是世經凡言“距”上元就要算外，但是看上面所引世經原文，世經並沒有這樣的體例。

這給驗算帶來了麻煩。要用三統曆驗算世經，首先就要根據世經所記載的年數排定曆譜，而曆譜中最重要的數據就是距上元年數，因爲所有計算都基於這個數據。這裏的困難在於，假如要同時照顧釐公五年與其他年數，例如太初元年的距上元年數，那在驗算時就不能用統一的算法來計算。當距上元年數是與釐公五年一樣時，就需要算外減一；當它與太初元年一樣時，就不用算外減一，而兩者的分界在哪裏，世經並沒有說。

世經還明確說：

> 凡伯禽至春秋，三百八十六年。\
> 春秋。隱公，春秋即位十一年，及桓公軌立。此元年上距伐紂四百歲。

上面已經列出世經所記載的自伯禽以來魯公年數，自伯禽即位至春秋（隱公元年），凡 $46+4+60+14+50+37+50+30+2+9+11+27+46=46+4+60+14+50+37+50+30+2+9+11+27+46=386$年。後面說隱公一段很奇怪，先說隱公即位十一年，到桓公立，後面說：“此元年上距伐紂四百歲”，初看肯定以爲這個元年指的是桓公元年。但是從伯禽到隱公元年有 386 年，再加隱公在位十一年，已經有 397 年了。這樣算，那伯禽即位就是在伐紂三年後，才能算出這年距伐紂四百年。可是伯禽即位之年，世經明確指明是“成王元年正月己巳朔，此命伯禽俾侯于魯之歲也”，很明顯不是伐紂三年之後。所以錢大昕在這裏說：“‘此元年’，謂隱元年也”。只有認爲這裏的元年是隱公元年，才能與世經所記載的年數對上。從伐紂到隱公元年總共四百年，伯禽即位到隱公元年 386 年，伯禽即位在成王元年。在此之前，武王伐紂之後七年而崩，然後周公攝政七年，加起來 14 年，再加 386 年，正好是四百年[^chengwang]。

[^chengwang]: 這裏也有問題。按照世經所說，周公攝政七年，沒有以成王紀年，直到周公歸政成王之後，纔開始用成王紀年。可是《史記·魯周公世家》：“成王七年二月乙未，王朝步自周，至豐，使太保召公先之雒相土。其三月，周公往營成周雒邑”，則是周公攝政時，已經用成王紀年。

伐紂克殷 142109 加 7 年是武王崩年 142116，再加五年爲周公攝政五年 142121。世經說這一年正月丁巳朔旦冬至，但是以 142121 驗算，所得冬至爲壬戌，如果算外減一，以 142120 驗算，所得冬至恰好是丁巳。劉操南以爲周公攝政五年這一年是 142120。如果周公攝政五年是 142120，那只有一種可能，就是武王崩之後未逾年即改元，也就是武王在位十一年，即伐紂之後七年，武王崩，周公就攝政改元。但是經史並沒有證據表示武王崩周公就攝政改元[^wuwang]。但是，這種解讀是有問題的，就是假如從伐紂克殷到周公攝政五年是十一年，那再加周公攝政七年剩下的兩年，那武王伐紂之後只有十三年，加上伯禽到春秋的 386 年，是 399 年而不是四百年。可見，劉操南的說法不對。這裏唯一的解釋就是這一年所用距上元年數也要算外減一，與釐公五年一樣。

[^wuwang]: 《史記·周本紀》：“武王病。天下未集，羣公懼，穆卜，周公乃祓齋，自爲質，欲代武王，武王有瘳。後而崩”，《集解》引皇甫謐說：“武王定位元年歲在乙酉，六年庚寅崩。”也就是武王伐紂之後六年就死了。王國維在《周開國年表》中認爲武王克殷二年之後就死了，根據是《史記》在武王崩年沒有指明是哪年，而上文最近的明確有紀年的是武王二年。這個證據不太可信。

所以這裏在排定曆譜時，如果所求年份在伐紂克殷 142109 之後、漢高祖元年 143025 以前，距上元年數就要算外減一，其餘年份則不用。

世經所記有朔旦冬至干支的年份有太甲元年、後九十五年、周公攝政五年、魯煬公二十四年以及之後每隔 76 年和太初元年。這些年份的冬至朔旦干支以及距上元年數如下表。用上述辦法來驗算，所得朔旦冬至干支完全相合。

| 紀年           |   距上元年數 | 冬至         |
|:--------------:|:------------:|:------------:|
| 湯沒之年       |       141493 | 商十二月乙丑 |
| 後九十五歲     |       141588 | 商十二月甲申 |
| 周公攝政五年   |       142121 | 正月丁巳     |
| 魯煬公二十四年 |       142197 | 正月丙申     |
| 微公二十六年   |       142273 | 正月乙亥     |
| 獻公十五年     |       142349 | 正月甲寅     |
| 懿公九年       |       142425 | 正月癸巳     |
| 惠公三十八年   |       142501 | 正月壬申     |
| 釐公五年       |       142577 | 正月辛亥     |
| 成公十二年     |       142653 | 正月庚寅     |
| 昭公二十年     |       142710 | 正月己丑     |
| 定公七年       |       142729 | 正月己巳     |
| 元公四年       |       142805 | 正月戊申     |
| 康公四年       |       142881 | 正月丁亥     |
| 緡公二十二年   |       142957 | 正月丙寅     |
| 漢高祖八年     |       143032 | 十一月乙巳   |
| 漢武帝元朔六年 |       143108 | 十一月甲申   |
| 漢武帝太初六年 |       143127 | 前十一月甲子 |
| 漢元帝初元二年 |       143184 | 十一月癸亥   |

後漢光武帝建武元年（公元 25 年），錢大昕以爲距上元 143255，距漢高祖元年（距上元 143025 年）230 年，這就是世經說的“自漢元年訖更始二年，凡二百三十歲”。

## 世經所記歲次

世經所記歲次有以下幾條（包括驗算得出的宿度）：

| 紀年           |距上元年數 | 歲在         | 宿度 |
|:--------------:|:----------|:------------:|:----:|
| 伐桀之歲       |    141480 | 大火房五度   | 房 5|
| 文王受命       |    142097 | 鶉火         | 房 5|
| 伐紂克殷       |    142109 | 鶉火張十三度 |張 13|
| 釐公五年       |    142577 | 大火         |氐 8 |
| 釐公十六年     |    142588 | 壽星         |軫 17|
| 釐公二十四年   |    142596 | 實沈         |參 1 |
| 襄公二十八年   |    142687 | 星紀         |女 4 |
| 襄公三十年     |    142689 | 娵訾         |壁 9 |
| 襄公三十一年   |    142690 | 降婁         |胃 3 |
| 昭公八年       |    142698 | 析木         | 斗 9|
| 昭公十年       |    142700 | 玄枵         | 危 14|
| 昭公三十二年   |    142722 | 星紀         | 斗 15|
| 漢高祖元年     |    143025 | 鶉首之六度   | 井 22|
| 漢武帝太初元年 |    143127 | 星紀婺女六度 | 女 6|
| 光武建武元年   |    143255 | 鶉尾之張度   | 亢 7|

如果所求年份在伐紂克殷 142109 之後、漢高祖元年 143025 以前，距上元年數就要算外減一，其餘年份則不用。用這種辦法驗算，除了光武建武元年之外，其餘歲次皆相合。光武建武元年，這一年歲次壽星，在亢七度。錢大昕已經指出了這處不合。

對於文王受命，這裏要多說幾句。世經說文王受命在伐紂之前十三年，那這一年距上元 142096 年，用這個數求得這一年歲在鶉首柳 2 度，而不是鶉火；但是如果以 142097 計算，這一年歲在鶉火張十度。歲次與世經所排年數矛盾，劉操南已經發現伐紂之前 13 年是 142096 而不是 142097，但計算文王受命歲次仍用 142097。又以積次計算太歲，伐紂克殷之年積次 415，太歲在辛未，而文王受命之年以 142097 計算，積次 403，太歲在己未。這些與錢大昕所算相合，可是太歲在己未距伐紂之年只有十一年，除非將己未包括在裏面。假設文王受命當年改元，到伐紂克殷之年就是文王受命十三年。所以合理的解釋應該是這裏所說的文王受命某年都是以文王受命爲元年來計算的，文王受命距上元也應該放在 142097 而不是 142096，劉操南說文王受命在 142096 不合理。

另外，襄公二十八年歲在星紀，《左傳·襄公二十八年》梓慎說：“歲在星紀，而淫於玄枵。”意思是今年歲星本來應該在星紀，但是卻在玄枵。玄枵在星紀後一次，也就是當時人所觀察到的天象比推算多走了一次，但是按照三統曆的計算，本年歲星正好在星紀而不是玄枵[^xingji]。

[^xingji]: 左傳正義也以三統術對這年的歲次進行了推算，所用距上元年數是“此年距上元積十四萬二千六百八十六歲”。世經明確記載釐公五年距上元 142577 年，這年朔旦冬至是辛亥；在襄公二十八年又說：“二十八年距辛亥百一十歲，歲在星紀”，所以襄公二十八年距上元一定是 $142577 + 110=142687$ 年。這也爲上面所說的從伐紂到漢高祖期間上元歲數要減一增添了一條新證據。

## 世經所記閏月

世經記載閏月有以下五處。

| 紀年         |   距上元年數 | 閏月 |
|:------------:|:------------|:-------------------------------|
| 伐紂克殷     | 142109 | 閏數餘十八，正大寒中，在周二月己丑晦。明日閏月庚寅朔 |
| 文公元年     | 142606 | 閏餘十三，正小雪，閏當在十一月後，而在三月 |
| 文公六年     | 142611 | 閏餘十，無閏而置閏 |
| 襄公二十七年 | 142686 | 九月乙亥朔，是建申之月也。魯史書：“十二月乙亥朔，日有食之。”傳曰：“冬十一月乙亥朔，日有食之，於是辰在申，司曆過也，再失閏矣。” |
| 昭公二十年   | 142710 | 正月己丑朔旦冬至，失閏 |

以三統曆中的推閏餘求各年的閏餘以及閏月（在伐紂之後的年份仍舊算外減一），結果如下表。伐紂克殷之年和文公元年與世經所記載的閏餘相合，閏月也一樣。

| 紀年         | 距上元年數 | 閏餘 | 閏月（自天正建子月起算） |
|:------------:|:----------:|:----:|:---------------|
| 伐紂克殷     | 142109 | 18 | 2 |
| 文公元年     | 142606 | 13 | 11 |
| 文公六年     | 142611 | 10 | 0 |
| 襄公二十七年 | 142686 | 3 | 0 |
| 昭公二十年   | 142710 | 0 | 0 |

按照三統曆，文公元年閏月應當在本年天正十一月，也就是閏十一月，而《左傳》所記則是閏三月，所以說“非禮也”。杜預說：“於曆法閏當在僖公末年”，與三統曆所算不合。文公六年閏餘 10，不到 12， 因此本年無閏月。《左傳》說：“閏月不告朔”，也就是這一年事實上是設置了閏月的，只不過未告朔而已。

襄公二十七年閏餘 3，本年無閏。《春秋》說：“冬十有二月乙亥朔，日有食之”，這年十二月朔日乙亥發生了日食；但是《左傳》說：“十一月乙亥朔，日有食之。辰在申，司歷過也，再失閏矣”，這個月斗建申，應該是夏正七月、周正九月。假如這個月的確是周正十一月，也就是夏正九月，斗建應該在戌而不是申。也就是說說今年比天象差了兩個月，所以說“再失閏矣”。假如依照《春秋》經文，日食發生在周正十二月建亥，那與建申差了三個月，不應該說“再失閏矣”。以推正月朔以及推朔日的辦法求襄公二十七年（距上元 142686，算外減一爲 142685）每月朔日如下：

| 月份 | 朔日干支 | 積日大餘 | 積日小餘 |
|:---- |:--------:|:--------:|:--------:|
|正月 | 戊寅 | 54 | 62 |
|2月 | 戊申 | 24 | 24 |
|3月 | 丁丑 | 53 | 67 |
|4月 | 丁未 | 23 | 29 |
|5月 | 丙子 | 52 | 72 |
|6月 | 丙午 | 22 | 34 |
|7月 | 乙亥 | 51 | 77 |
|8月 | 乙巳 | 21 | 39 |
|9月 | 乙亥 | 51 | 1 |
|10月 | 甲辰 | 20 | 44 |
|11月 | 甲戌 | 50 | 6 |
|12月 | 癸卯 | 19 | 49 |

襄公二十七年乙亥朔應當是周正九月，而不是十一月，與《左傳》所記相合。

昭公二十年《左傳》：“二月己丑，日南至”，也就是這年冬至在二月己丑朔。按照三統曆，這一年距上元 142710（計算時要減一爲 142709），正月朔旦己丑，而不是二月。也就是說這一年之前少了一個閏月，所以世經說“失閏”。

## 世經所載日名與積日

除了朔旦冬至之外，世經還記錄了一些日名，這些日名也可以用三統曆進行驗算。

### 武王伐紂日名

世經對武王伐紂有詳細的記載：

> 師初發，以殷十一月戊子，日在析木箕七度，故傳曰：“日在析木。”是夕也，月在房五度。房為天駟，故傳曰：“月在天駟。”後三日得周正月辛卯朔，合辰在斗前一度，斗柄也，故傳曰：“辰在斗柄。”明日壬辰，晨星始見。癸巳武王始發，丙午還師，戊午度于孟津。孟津去周九百里，師行三十里，故三十一日而度。明日己未冬至，坻星與婺女伏，歷建星及牽牛，至於婺女天黿之首，故傳曰：“星在天黿。”周書武成篇：“惟一月壬辰，旁死霸，若翌日癸巳，武王乃朝步自周，于征伐紂。”序曰：“一月戊午，師度于孟津。”至庚申，二月朔日也。四日癸亥，至牧野，夜陳，甲子昧爽而合矣。故外傳曰：“王以二月癸亥夜陳。”武成篇曰：“粵若來三月，既死霸，粵五日甲子，咸劉商王紂。”是歲也，閏數餘十八，正大寒中，在周二月己丑晦。明日閏月庚寅朔。三月二日庚申驚蟄。四月己丑朔死霸。死霸，朔也。生霸，望也。是月甲辰望，乙巳，旁之。故武成篇曰：“惟四月既旁生霸，粵六日庚戌，武王燎于周廟。翌日辛亥，祀于天位。粵五日乙卯，乃以庶國祀馘于周廟。”

根據上面這段話，可以排出武王伐紂的日期與事件，如下表：

|干支序數    |日名                   |事件                         |月日           |
|:-----------|:----------------------|:----------------------------|:--------------|
|24          | 殷十一月戊子          | 師初發                      |殷十一月       |
|27          | 周正月辛卯朔          | 後三日                      |周正月一日     |
|28          | 明日壬辰              |旁死霸                       |正月二日       |
|29          | 癸巳                  | 武王始發                    |正月三日       |
|42          | 丙午                  | 還師                        |正月十六       |
|54          | 戊午                  | 度于孟津                    |正月二十八     |
|55          |己未                   |冬至                         |正月二十九     |
|56          | 庚申                  | 二月朔日                    |二月一日       |
|59          | 四日癸亥              | 至牧野，夜陳                |二月四日       |
|0           | 甲子                  | 昧爽而合矣                  |二月五日       |
|25          | 周二月己丑晦          |大寒                         |二月三十       |
|26          | 明日閏月庚寅朔        |                             |閏二月一日     |
|56          | 三月二日庚申          | 驚蟄                        |三月二日       |
|25          | 四月己丑朔            | 死霸                        |四月一日       |
|40          | 是月甲辰              | 望                          |四月十六       |
|41          | 乙巳                  | 旁生霸                      |四月十七       |
|46          | 六日庚戌              | 武王燎于周廟                |四月二十二     |
|47          | 翌日辛亥              | 祀于天位                    |四月二十三     |
|51          | 粵五日乙卯            | 乃以庶國祀馘于周廟          |四月二十七     |

爲了與上表對照，可以根據三統曆的推算方法計算出這一年，也就是距上元 142109 年的干支日名表，其中，所有有關的日期都用粗體表示（戊子是前一年，也就是辛卯前三天）：

|    |       |        |        |        |        |        |        |        |        |        |
|:---|:------|:-------|:-------|:-------|:-------|:-------|:-------|:-------|:-------|:-------| 
| 1 月 | **1辛卯** |  **2壬辰** |  **3癸巳** |  4甲午 |  5乙未 |  6丙申 |  7丁酉 |  8戊戌 |  9己亥 |  10庚子 |
|    | 11辛丑 | 12壬寅 | 13癸卯 | 14甲辰 | 15乙巳 | **16丙午** | 17丁未 | 18戊申 | 19己酉 | 20庚戌 |
|    | 21辛亥 | 22壬子 | 23癸丑 | 24甲寅 | 25乙卯 | 26丙辰 | 27丁巳 | **28戊午** | **29己未** |
| 2 月 | **1庚申** |  2辛酉 |  3壬戌 |  **4癸亥** |  **5甲子** |  6乙丑 |  7丙寅 |  8丁卯 |  9戊辰 |  10己巳 |
|    | 11庚午 | 12辛未 | 13壬申 | 14癸酉 | 15甲戌 | 16乙亥 | 17丙子 | 18丁丑 | 19戊寅 | 20己卯 |
|    | 21庚辰 | 22辛巳 | 23壬午 | 24癸未 | 25甲申 | 26乙酉 | 27丙戌 | 28丁亥 | 29戊子 | **30己丑** |
| 閏 2 月 | **1庚寅** |  2辛卯 |  3壬辰 |  4癸巳 |  5甲午 |  6乙未 |  7丙申 |  8丁酉 |  9戊戌 |  10己亥 |
|    | 11庚子 | 12辛丑 | 13壬寅 | 14癸卯 | 15甲辰 | 16乙巳 | 17丙午 | 18丁未 | 19戊申 | 20己酉 |
|    | 21庚戌 | 22辛亥 | 23壬子 | 24癸丑 | 25甲寅 | 26乙卯 | 27丙辰 | 28丁巳 | 29戊午 |
| 3 月 | 1己未 |  **2庚申** |  3辛酉 |  4壬戌 |  5癸亥 |  6甲子 |  7乙丑 |  8丙寅 |  9丁卯 |  10戊辰 |
|    | 11己巳 | 12庚午 | 13辛未 | 14壬申 | 15癸酉 | 16甲戌 | 17乙亥 | 18丙子 | 19丁丑 | 20戊寅 |
|    | 21己卯 | 22庚辰 | 23辛巳 | 24壬午 | 25癸未 | 26甲申 | 27乙酉 | 28丙戌 | 29丁亥 | 30戊子 |
| 4 月 | **1己丑** |  2庚寅 |  3辛卯 |  4壬辰 |  5癸巳 |  6甲午 |  7乙未 |  8丙申 |  9丁酉 |  10戊戌 |
|    | 11己亥 | 12庚子 | 13辛丑 | 14壬寅 | 15癸卯 | **16甲辰** | **17乙巳** | 18丙午 | 19丁未 | 20戊申 |
|    | 21己酉 | **22庚戌** | **23辛亥** | 24壬子 | 25癸丑 | 26甲寅 | **27乙卯** | 28丙辰 | 29丁巳 | 30戊午 |

其中，從殷十一月戊子，師初發，再過兩天就是周正月辛卯朔，到周二月庚申朔，是一個月，再過五天就是二月五日甲子。所以世經所引武成“粵若來三月”有誤。如果算從師發總共過了多久，那就是一個月，而如果是說哪個月，那就應該是二月。李仲操認爲應該是二月之誤。王引之《經義述聞·爾雅·來懷至也》：“《召誥》‘越若來三月’……‘越若來三月’五字連讀，越若，語詞，來，至也。言越若至三月也。”如果王引之說的是對的，那就應該解釋成到了三月。戊子干支序數是 24，庚申是 56，甲子是 0，戊子到甲申之間的積日可以是 $56-24=32$ 天，也可能是 $56 + 60 - 24 = 92$ 天。如果是 92 天，那就與“三月”不矛盾，但是這又跟“四月旁生霸”矛盾。所以要解釋武王伐紂的日期，不僅要考慮干支積日、還要考慮月相。

### 其他日名

除了武王伐紂這年的日名之外，世經還記載了以下這些日名。按照三統曆推算這些日子的日名，與世經所載日名對照，如下表。

| 紀年 | 日名 | 距上元年數 | 月日 | 三統曆求得日名 |
|:---- |:----:|:----------:|:----:|:--------------:|
| 周公攝政七年 | 乙亥 | 142123 | 2月1日 | 乙亥 |
| 周公攝政七年 | 庚寅 | 142123 | 2月16日 | 庚寅 |
| 周公攝政七年 | 乙未 | 142123 | 2月21日 | 乙未 |
| 周公攝政七年 | 甲辰 | 142123 | 3月1日 | 甲辰 |
| 周公攝政七年 | 丙午 | 142123 | 3月3日 | 丙午 |
| 周公攝政七年 | 戊辰 | 142123 | 13月29日 | 戊辰 |
| 成王元年 | 己巳 | 142124 | 1月1日 | 己巳 |
| 成王三十年 | 庚戌 | 142153 | 4月1日 | 庚戌 |
| 成王三十年 | 甲子 | 142153 | 4月15日 | 甲子 |
| 成王三十年 | 乙丑 | 142153 | 4月16日 | 乙丑 |
| 康王十二年 | **戊辰** | 142165 | 6月1日 | 己巳 |
| 康王十二年 | **庚午** | 142165 | 6月3日 | 辛未 |
| 釐公五年 | 甲午 | 142577 | 8月18日 | 甲午 |
| 釐公五年 | 丙子 | 142577 | 12月1日 | 丙子 |
| 文公十一年 | 甲子 | 142616 | 3月1日 | 甲子 |
| 襄公二十七年 | 乙亥 | 142686 | 9月1日 | 乙亥 |
| 襄公三十年 | 癸未 | 142689 | 2月24日 | 癸未 |
| 昭公十八年 | 丙子 | 142708 | 5月8日 | 丙子 |
| 昭公十八年 | 戊寅 | 142708 | 5月10日 | 戊寅 |
| 昭公十八年 | 壬午 | 142708 | 5月14日 | 壬午 |

康王十二年距上元 142165 年的兩個日名都不對。世經說：

> 康王十二年六月戊辰朔，三日庚午，故畢命豐刑曰：“惟十月二年六月庚午朏，王命作策豐刑。”

明確指出戊辰是康王十二年六月一日，而庚午是六月三日；而以三統曆推算，六月一日是己巳，三日是辛未。康王十二年這年的確有戊辰朔日，但是是八月，這個月三日也是庚午。由此可見，這裏應該是將八誤作了六。李銳在《漢三統術》中已經指出了這一點了。可是《尚書·畢命 》中就是“六月庚午朏”。這裏有幾種可能。一種可能是世經爲了保持與三統曆的一致，改動了經文，而現在之所以又與尚書一致，原因是後來的人不明白世經的改動邏輯，看到世經與尚書不合，又給改回去了。另一種可能是世經明知經文與三統曆推算的不合，還是引用了尚書。這兩種都沒有什麼證據，但根據奧卡姆剃刀原則，後一種可能性比前一種更大。因爲前一種有兩個假設，一是世經改動了經文，二是後來的人改動了世經；而後一種只有一個假設，就是世經沒有改動經文。兩個假設同時爲真的概率當然小於一個假設爲真的概率。

這裏順便整理一下世經裏面的月相與月日的關係。

| 月相 | 紀年 | 距上元年數 | 月日 |
| ---- | ---- | ---------- | ---- |
| 旁死霸 | 伐紂 | 142109 | 正月二日壬辰 |
| 既死霸 | 伐紂 | 142109 | 二月五日甲子 |
| 死霸 | 伐紂 | 142109 | 四月一日己丑朔 |
| 望 | 伐紂 | 142109 | 四月十六日甲辰 |
| 望 | 周公攝政七年 | 142123 | 二月十六庚寅 |
| 旁生霸 | 伐紂 | 142109 | 四月十七乙巳 |
| 朏 | 周公攝政七年 | 142123 | 三月三日丙午 |
| 朏 | 康王十二年 | 142165 | 六月戊辰 |
| 哉生霸 | 成王三十年 | 142153 | 四月十五日甲子 |

世經中明確指實月相在一月中哪一天的有：

> 死霸，朔也。生霸，望也。\
> 古文月采篇曰“三日曰朏”。

將這些月相按照一月日子的先後排列，就得到下面的表格：

| 月相 | 月日 |
|:---- |:---- |
| 死霸 | 朔一日 |
| 旁死霸 | 二日 |
| 朏 | 三日 |
| 既死霸 | 五日 |
| 哉生霸 | 十五日 |
| 望 | 十五或十六日 |
| 旁生霸 | 十七日 |

### 襄公三十一年絳縣老人所說積日

世經在襄公三十一年有這樣一段話：

> 三十年歲在娵訾，三十一年歲在降婁。是歲距辛亥百一十三年，二月有癸未，上距文公十一年會于承匡之歲夏正月甲子朔凡四百四十有五甲子，奇二十日，為日二萬六千六百有六旬。故傳曰絳縣老人曰：“臣生之歲，正月甲子朔，四百四十有五甲子矣。其季於今，三之一也。”師曠曰：“郤成子會于承匡之歲也，七十三年矣。”史趙曰：“亥有二首六身，下二如身，則其日數也。”士文伯曰：“然則二萬六千六百有六旬也。”

這一段是說從文公十一年（距上元 142616 年）的夏正月甲子朔，到襄公三十年（距上元 142689 年）二月癸未，總共有 445 個甲子，而最後一個甲子只有 20 天，總共積日 $60 \times 444 + 20 = 26660$，也就是二萬六千六百日有六旬（一旬十日）。這一段話也相當凌亂。錢大昕已經指出這段話中的“是歲”指的是襄公三十年，而不是三十一年。這一點可以根據《左傳》得到驗證，因爲絳縣老人的話在《左傳》中是出現在襄公三十年而不是三十一年的。但是世經在這裏明確指出“是歲”距辛亥（也就是釐公五年正月辛亥距上元 142577 年）113 年，所以這年距上元 $142577 + 113 = 142690$，所以這裏的“是歲”一定是襄公三十一年。而且上文明確說“襄公二十七年，距辛亥百九歲……二十八年距辛亥百一十歲，歲在星紀”，二十七年到三十一年四年，109 加四年正好距辛亥 113 年，而二十八年到三十一年三年，110 加三年正好距辛亥 113 年。這些都說明世經在這裏說的“是歲”絕對是襄公三十一年，而不可能是襄公三十年。下面再通過三統曆進行驗算。

以襄公三十年距上元 142689 年驗算，因爲襄公三十年在伐紂之後，計算要算外減一，即用 142688 計算，算出來本年正月、二月的朔日干支及大小餘是：

| 月 | 日名 | 大餘 | 小餘 |
| -- | ---- | ---- | ---- |
| 正月 | 辛卯 | 27 | 33 |
| 2月  | 庚申 | 56 | 76 |

庚申大餘 56，也就是干支序數是 56，而癸未干支序數 19，那癸未就是 $(60- 56) + 19 + 1 =24$（干支序數從 0 開始，所以要加一）日；而以 142689 （襄公三十一年距上元 142690）計算，二月朔日是乙卯，大餘 51，是$(60-51)+19+1=29$日，三月朔日 甲申，大餘 20，正好是二月晦日。

再算積日。襄公三十年積月 13605，積月小餘 5，文公十一年積月 12702，小餘 7；期間積月 $13605-12702 = 903$。晉國用夏正，文公十一年夏正正月是周正三月，所以要在積月中減去兩個月；到襄公三十年二月癸未，本年正月小 29 天（由正、二月積日大餘也可以看出，二月大餘 56，減正月大餘 27，正月 29 天），到二月癸未 24 天，要加 53 天。也就是：

\begin{align*}
&\text{襄公三十年到文公十一年夏正正月積月}\\\\
=&\text{襄公三十年到文公十一年積月} - 2 &\text{夏正正月是周正三月} \\\\
=&\text{襄公三十年積月} - \text{文公十一年積月} -2 \\\\
=&13605-12702 -2\\\\
=&901\\\\
&\text{襄公三十年二月癸未到文公十一年夏正正月甲子積日}\\\\
=&\text{襄公三十年到文公十一年夏正正月積月} \times \text{一月日長} + \text{襄公三十年到二月癸未 24 日時長}\\\\
=&901 \times \frac{2392}{81} + (29 + 24)&\text{襄公三十年正月小 29 天}\\\\
=&26660 \frac{25}{81}
\end{align*}

算出來正好是 26660 天[^gao]。

[^gao]: 郜積意在《〈世經〉三統術與劉歆〈春秋〉學》（見《兩漢經學的曆術背景》 111 頁）中的計算是：“襄公三十年距文公十一年，積月共 $902 \frac{17}{19}$，除去文公十一年周正正月、二月共 59 日，加襄公三十年之正月及二月二十四日（共 53 日），則積日 29958”。按，積月 902 積日爲 $902 \times \frac{2392}{81} = 26636 \frac{68}{81}$，減去 59 天、加上 53 天，就是減去 6 天，得到 26630 天，不是 29958，不知道他怎麼算的。另外，他所算的積月是將襄公三十年積月連帶小餘減去文公十一年的積月與小餘，所以得出$902 \frac{17}{19}$的值。但是在算這兩年之間總共有多少個月時，不應該減去積月小餘。換一種辦法算，從文公十一年 142616 到襄公三十年 142689 總共 73 年；又由推閏餘算出這 73 年間總共 27 年有閏月，也就是這 73 年總共 $73 \times 12 + 27 = 903$個月，而不是$902 \frac{17}{19}$。郜積意的算法是錯誤的。基於錯誤的計算，他得出了劉歆三統曆的計算和左傳記載不符的錯誤結論。

## 世經所載日月行度

世經所載日月行度與合晨度主要以以下這幾條：

| 紀年 | 距上元年數 | 日期 | 天象 |
|:----|:-------:|:----:|:-----|
| 伐紂之年 | 142109 | 殷十一月戊子 | 日在析木箕七度；是夕也，月在房五度 |
| 伐紂之年 | 142109 |  周正月辛卯朔  | 合辰在斗前一度 |
| 釐公五年 | 142577 | 冬十二月丙子 | 日在尾，月在策，鶉火中 |

### 武王伐紂出師之日的日月行度

> 師初發，以殷十一月戊子，日在析木箕七度，故傳曰：“日在析木。”是夕也，月在房五度。房為天駟，故傳曰：“月在天駟。”後三日得周正月辛卯朔，合辰在斗前一度，斗柄也，故傳曰：“辰在斗柄。”

對伐紂之年日在星度的計算有一些疑問。世經說：“殷十一月戊子，日在析木箕七度”，並沒有說在戊子的哪個時刻日在析木箕七度。根據三統曆“推合晨”，伐紂之年（距上元 142109 年）正月朔日的合晨度是 337，大餘 421，日夜半所在星度是 336 度，小餘 1409，以 1539 爲法。假如世經所說的是日夜半所在星度，殷十一月戊子是周正正月一日前三天，太陽每天運行一度，前三天夜半太陽就在 $336-3 = 333$ 度。與歲星所在星度從斗初（十二次從星紀開始）開始數不同，日月所在星度要從牽牛開始數。算出來戊子夜半日在箕 $5 \frac{1409}{1539}$ 度。錢大昕先算出殷十一月戊子的積日 190264（伐紂之年積日 190267，前三日，就是減三），再以合晨度算法計算，得出當天星度 333 度（120 頁）。李銳則先求伐紂之年正月朔日合晨度 $337 \frac{421}{1539}$，再減三天對應的三度，又減小餘 551[^fz]，得出戊子日所在星度爲 $333 \frac{1409}{1539}$。333 度從牽牛初度算起到箕宿是 5 度，因爲牽牛初度到箕宿累計 328 度，333 減去 328 應該是 5 度，又根據三統曆“推合晨所在星”，這個數值要算外，加一。也就是戊子這一天太陽在箕宿 $6 \frac{1409}{1539}$ 度。（劉操南說此條“疑有誤”，也沒說誤在哪裏。）

這裏討論一下合晨度的問題。從錢大昕、李銳起，都遵循三統曆所說，合晨度從牽牛起算都要“算外”加一；但《中國古代曆法》和劉洪濤（34 頁）都沒有加一。這裏恐怕涉及到古人對度的理解。古人對度數與現代人的理解不同，古人的度是一個範圍，而現代人的度則是一個點（中國古代曆法 289 頁）。

[^fz]: 以 19 乘以積日小餘 29，也就是要從合晨度中減去的合晨時刻距夜半小餘。 

再算戊子日月所在星度。伐紂之年正月辛卯朔合晨度 $337 \frac{421}{1539}$，這天夜半月在 $332 \frac{750}{1539}$。戊子日距離辛卯三日，戊子日之夕就是戊子日的晚上，距離辛卯兩天多。月亮每天行 $13 \frac{7}{19}$（見“推其月夜半所在星”）。辛卯日合晨度減去月亮兩天的行度就是：

\begin{align*}
&\text{辛卯朔合晨度}-\text{戊子夕到辛卯朔月亮行度}\\\\
=&332 \frac{750}{1539} - 2 \times 13 \frac{7}{19}\\\\
=&\frac{332 \times 1539 + 750}{1539} - \frac{2 \times 13 \times 19 \times 81 + 2 \times 7 \times 81}{19 \times 81}\\\\
=&\frac{477916}{1539}\\\\
=&305 \frac{1155}{1539}
\end{align*}

305 度從牽牛初度算起，是心宿 1 度，戊子日的傍晚（“是夕”，《說文》：“夕，莫也。”“莫，日且冥也。”）距離夜半還有幾個小時，所以這天傍晚月亮應該還沒走到心宿，心前一個星宿是房宿，所以傍晚月亮在房宿。這就是世經說的：“是夕也，月在房五度。房為天駟，故傳曰：月在天駟。”

伐紂之年正月朔合晨度 $337 \frac{421}{1539}$ 度，從牽牛初度起算，算外加一，爲箕 10 度。箕總共 11 度，下一宿爲斗，也就是這天合晨距斗一度，所以世經說：“合辰在斗前一度”。

### 釐公五年晉侯滅虢之日的日月行度

除了伐紂出師這天的天象，世經還記載了釐公五年（距上元 142577 年）十二月丙子的合晨度和日月所在星度。世經說：

> 釐公五年正月辛亥朔旦冬至，殷曆以為壬子，距成公七十六歲。\
> 是歲距上元十四萬二千五百七十七歲，得孟統五十三章首。故傳曰：“五年春王正月辛亥朔，日南至。”\
“八月甲午，晉侯圍上陽。”章謠云：“丙子之辰，龍尾伏辰，袀服振振，取虢之旂。鶉之賁賁，天策焞焞，火中成軍，虢公其奔。”卜偃曰：“其九月十月之交乎？丙子旦，日在尾，月在策，鶉火中，必是時也。”冬十二月丙子滅虢。

這一段說的是晉侯滅虢那天的天象。童謠[^tong]中說的“丙子之辰，龍尾伏辰”，意思是丙子這天日月合朔時，日月在尾宿。“鶉之賁賁，天策焞焞，火中成軍”按照杜預的解釋，意思是“南方鶉鳥之星，其體賁賁然見於南方。天策之星近日，焞焞然無光耀，甚微也。鶉火之次正中於南方，爾時其當成軍事也。”這裏提到的星有鶉、天策、火。正義說：“南方七宿皆爲朱鳥之宿”，也就是說“鶉之賁賁”中的鶉是指南方井、鬼、柳、星、張翼軫鶉鳥七宿。這七宿在十二次中對應鶉首、鶉火、鶉尾三次。鶉火，正義說是“柳星張也”，就是柳、星、張三宿。天策則是箕宿。《正義》又說：“天策，傅說星，史記天官書之文”，查《天官書》，沒有這一句。但是傅說化爲箕星，是先秦著名的傳說，見《莊子·大宗師》。這幾句對應的天象就是釐公五年十二月丙子朔這天，合朔在尾宿，所以尾宿伏，看不見；天策，也就是箕宿，也黯淡無光。“火中成軍”，指的是當天早上日出之前鶉火出現在正南方，正是滅虢的軍隊集結的時候。卜偃解釋說：“丙子旦，日在尾，月在策，鶉火中”。總結一下，這天的天象有以下幾條：

1. 日月合朔在尾，箕宿黯淡
2. 日出時，日在尾宿
3. 日出時，月在箕宿（天策）
4. 日出時，鶉火出現在正南方

要驗算這些天象，首先先計算釐公五年十二月丙子的合晨度，也就是日月合朔所在星度。釐公五年十二月丙子正好是十二月一日，也就是日月合朔的日子。周十二月是夏十月，十二月朔就是九月、十月之交，所以卜偃說“其九月、十月之交乎？”。這個月丙子朔無小餘。要算這天的積日只要先求釐公六年正月朔日積日，再減去釐公五年十二月的日數就可以了。釐公六年正月朔日積日 361221，釐公五年十二月小 29 天，釐公五年十二年丙子積日 $361221 - 29 = 361192$。求丙子日的合晨度只要用積日就可以了，因爲當日小餘爲 0。丙子日合晨度爲 $324 \frac{1292}{1539}$ 度，由牽牛初度起算，在尾 15 度。十二月丙子日合朔在尾 15 度，這也就是世經中童謠所說的“丙子之辰，龍尾伏辰”（《左傳·僖公五年》）。《左傳正義》說：“在尾十四度”，錢大昕以爲“疑誤”，其實很可能是孔穎達在換算的時候沒有考慮到由牽牛初度起需要算外，所以度數需要加一。

[^tong]: 左傳作童謠，世經中寫作章謠應該是誤字。

當天沒有小餘，日月夜半所在星度與合晨度是一樣的[^hechen]。箕宿就在尾宿之後，日月合朔在尾，那箕宿就肯定黯淡無光。

太陽每天運行一度，假設從夜半到日出有六個小時，在這六小時中日行 $\frac{1}{4}$ 度，所以日出時，日還在尾。月亮一天運行 $13 \frac{7}{19}$ 度，六小時就運行 $13 \frac{7}{19} \times \frac{1}{4} = \frac{254}{76} = 3 \frac{26}{76}$，就是三度多。尾總共十八度，月夜半在尾 15 度，日出時候月亮正好運行到箕宿，所以說“月在策”。

[^hechen]: 因爲要計算日月夜半所在星度，只要在合晨度上減去積日小餘與日月每日行度的乘積。當積日小餘等於零的時候，就相對於合晨度減去零，還是等於合晨度。

“鶉火中”是日出時，鶉火的柳心張三宿出現在正南方。這種天象跟恆星年有關。正義引《月令》說：“孟冬之月，日在尾，昏危中，旦七星中。”七星就是星宿，所以這天日出鶉火在正南方。

## 世經所載五星行度

世經所載五星行度只有伐紂之年水星行度一處：

| 紀年 | 距上元年數 | 日期 | 天象 |
|:----|:-------:|:----:|:-----|
| 伐紂之年 | 142109 |  正月二日壬辰  | 晨星始見 |
| 伐紂之年 | 142109 | 正月二十九己未 | 冬至，晨星與婺女伏，歷建星及牽牛，至於婺女天黿之首 |

晨星是水星，古人將水星稱作辰（見左傳襄公二十八年正義）。這裏晨通辰，與合晨度中的晨一樣。這裏詳細記錄了水星從夕始見到伏的時間和所在星次。其中婺女就是女宿，牽牛就是牛宿。建星、天黿需要解釋一下。

《國語·周語下·景王問鍾律於伶州鳩》：“我姬氏出自天黿，及析木者，有建星及牽牛焉”，韋昭注說：“天黿，即玄枵……從斗一度至十一度，分屬析木，日辰所在也。建星在牽牛閒，謂從辰星所在。須女，天黿之首。”根據韋昭的注，這裏所說的建星在牽牛中，天黿就是十二次中的玄枵。玄枵起于婺女八度，所以女宿是玄枵這一次的起點。所以這裏所記載的水星運行情況就是：

1. 伐紂之年正月二日壬辰，水星開始出現
2. 26 天之後（從正月三日開始數），正月 29 日己未，水星隱伏不見。水星伏的位置在女宿，而這次水星出現到伏經過的星宿有建星、牽牛，一直到婺女，也就是玄枵的起始點。

要驗證水星的運行情況，首先要求水星始見的時間和所在星次，然後需要基於水星始見的情況，根據“推五步”來推算水星在始見之後的運行情況。 

水星歲數 9216，見中法 29041。由紀術可以推算出有關水星始見的結果如下：

1. 推見復：定見復數爲 447806，見復餘爲 7373，見復爲 1
2. 推星見中次：今年水星出現在處暑，在十二次的位置是鶉尾
3. 推星見月：水星出現在十月
4. 推至日：這年處暑的干支是丁巳
5. 推朔日：本月朔日干支是壬戌
6. 推入月日：星見在本月 25 日，本月朔日壬戌，25 日是丙戌

推見復求得見復爲 1，也就是水星會在本年出現，但是要注意，這裏的本年不是伐紂之年，而是伐紂之前一年。水星出現在伐紂之前一年十月 25 日丙戌，出現位置是鶉尾。

根據五步，水星晨見先逆行 1 天，再留 2 天，順行 7 天，順行疾 18 天，伏 $37 \frac{122029605}{134082297}$，從晨始見到始伏的總日數爲 $65 \frac{122029605}{134082297}$ 日，也就是從晨始見到夕始見之間間隔 65 天多，將近 66 天。從 10 月 25 日數第 66 天正好到第二年正月二日壬辰，所以世經說：“壬辰，晨星始見”。

水星晨始見到伏，總共運行 $96 \frac{46610128}{134082297}$ 度。由軫 11 度數 96 度到斗 15 度，也就是水星始伏在斗 15 度。

水星從夕始見到再次伏總共經過 26 天。從正月二日壬辰數 26 天正好到正月 29 日，水星再次隱伏不見。水星夕始見之後順行 $16 \frac{1}{2}$ 天，每天行 $1 \frac{1}{3}$ 度；然後順行遲 7 天，每天行 $\frac{6}{7}$ 度；繼而留一天半，運行度數爲 0；最後逆行一天，行 2 度。這 26 天多總共運行 $26 \frac{2}{3}$ ：

$$16 \frac{1}{2} \times 1 \frac{1}{3} + 7 \times \frac{6}{7} + 2 = 26 \frac{2}{3}$$

由斗 15 度再加 26 度，就到女宿 7 度。也就是說水星再次伏的位置在女宿，也就是玄枵的起點。這些都與世經所記載的相合。

## 參考文獻

- 李銳. 漢三統術三卷. 續修四庫全書·子部·天文算法類，第 1045 冊.
- 錢大昕. 三統術衍. 自“夫曆春秋者”始. 《嘉定錢大昕全集·第八冊》. 江蘇古籍出版社. 1997.
- 陳澧. 三統術詳說. 光緒廣雅書局刻本.
- 成蓉鏡. 三統術補衍. 叢書集成續編，第 79 冊.
- 張培瑜、陳美東、薄樹人和胡鐵珠. (2008). 中国古代历法.中国科学出版社.
- 劉操南. (2009). 古代天文曆法釋證. 浙江大學出版社.
- 劉洪濤. (2003). 古代曆法計算法. 南開大學出版社.
- 夏國強. (2015). 《漢書·律曆志》研究. 花木蘭文化出版社.

# 《漢書·律曆志》筆記（7）：三統曆常數、公式一覽

## 統母

| 時間單位 | 年    | 月 | 日 | 中氣 |
| :------- | :----- | :------ | :---- | :---- |
| 日 |  |  | 1 | |
| 策餘 8080 | | | $365 \frac{385}{1539} - 360 = 5 \frac{385}{1539} = \frac{8080}{1539}$ | |
| 月 |  | 1 | $29 \frac{43}{81} = \frac{2392}{81} = \frac{\text{月法}}{\text{日法}}$  | |
| 節氣 | $\frac{1}{24}$ |  | $365 \frac{385}{1539} \div 24 = \frac{70265}{4617} = 15 \frac{1010}{4617}$ | |
| 中氣 | $\frac{1}{12}$ | $\frac{235}{19} \div 12 = \frac{235}{228} = \frac{\text{章月}}{\text{章中}}$ | $365 \frac{385}{1539} \div 12 = \frac{140530}{4617} = \frac{\text{中法}}{\text{元法}} = 30 \frac{2020}{4617}$ | 1 |
| 年 | 1 | $\frac{235}{19} = \frac{\text{章月}}{\text{章歲}}$ | $365 \frac{385}{1539} = \frac{562120}{1539} = \frac{周天}{統法}$ | 歲中 12 |
| 章 | 閏法/章歲 19 | 章月 235 | $365 \frac{385}{1539} \times 19 = \frac{10680280}{1539} = \frac{562120}{81}$ | 章中 $12 \times 19 = 228$ |
| 周至 | 周至 $3 \times 19 = 57$ | | | |
| 篇 | 篇 $4 \times 19 = 76$ | | | |
| 統 | 統法 $81 \times 19 = 1539$ | 統月 $81 \times 235 = 19035$ | 周天 $81 \times \frac{562120}{81} = 562120$ | 統中 $81 \times 228 = 18468$ |
| 元 | 元法 $3 \times 1539 = 4617$  | 元月 $3 \times 19035 = 57105$ | $3 \times 562120 = 1686360$ | 元中 $3 \times 18468 = 55404$ |
| 一個月食週期 | | 朔望之會 135 |
| 會月 | | 會月 $會數 \times 朔望之會 = 47 \times 135 = 6345$ |

## 紀母

紀母中最基本的數值是歲數和見中法，紀母中的其他數值都能從中推算而出。下面的表格就是紀母各項數值的計算公式（據《中國古代曆法》271 頁）。

| 紀母 | 公式 |
| -------------- | --------------- |
| 小周 | |
| 歲數 | |
| 見中分 | $\text{歲數}\times 12$ |
| 見中法 | |
| $\text{積中} \frac{\text{中餘}}{見中法}$ | $\frac{\text{見中分}}{\text{見中法}}$ |
| $\text{積中}$ | $\text{見中分} \ \mathbf{div}\ \text{見中法}$ |
| $\text{中餘}$ | $\text{見中分} \ \mathbf{mod}\ \text{見中法}$ |
| 見閏分 | $\text{歲數} \times 7$ |
| $\text{積月} \frac{\text{月餘}}{\text{見月法}}$ | $\frac{\text{歲數} \times 235}{19 \times \text{見中法}}=\frac{\text{歲數} \times 235}{\text{見月法}}$ |
| 積月 | $\text{歲數} \times 235 \ \mathbf{div}\ \text{見月法}$ |
| 月餘 | $\text{歲數} \times 235 \ \mathbf{mod}\ \text{見月法}$ |
| 見月法 | $19 \times \text{見中法}$ |
| 見中日法 | $\text{見月日法}\times 3$ |
| 見月日法 | $\text{見月法} \times \text{日法}=\text{見中法}\times 1539$ |
| 晨中分 | $\text{見中分} \times \frac{9}{16}$ |
| $\text{晨積中}\frac{\text{中餘}}{\text{見中法}}$ | $\frac{\text{晨中分}}{\text{見中法}}$ |
| 積中 | $\text{晨中分} \ \mathbf{div}\ \text{見中法}$ |
| 中餘 | $\text{晨中分} \ \mathbf{mod}\ \text{見中法}$ |
| 夕中分 | $\text{見中分} \times \frac{7}{16}$ |
| $\text{夕積中}\frac{\text{中餘}}{\text{見中法}}$ | $\frac{\text{夕中分}}{\text{見中法}}$ |
| 積中 | $\text{夕中分} \ \mathbf{div}\ \text{見中法}$ |
| 中餘 | $\text{夕中分} \ \mathbf{mod}\ \text{見中法}$ |
| 晨閏分 | $\text{見閏分} \times \frac{9}{16}$ |
| $\text{晨積月} \frac{\text{月餘}}{\text{見月法}}$ | $\frac{\text{歲數} \times 235}{\text{見月法}} \times \frac{9}{16}$ |
| 積月 | $(\text{歲數} \times 235 \times 9) \ \mathbf{div}\ (\text{見月法}\times16)$ |
| 月餘 | $(\text{歲數} \times 235 \times 9) \ \mathbf{mod}\ (\text{見月法}\times16)$ |
| 夕閏分 | $\text{見閏分} \times \frac{7}{16}$ |
| $\text{夕積月} \frac{\text{月餘}}{\text{見月法}}$ | $\frac{\text{歲數} \times 235}{\text{見月法}} \times \frac{7}{16}$ |
| 積月 | $(\text{歲數} \times 235 \times 7) \ \mathbf{div}\ (\text{見月法}\times16)$ |
| 月餘 | $(\text{歲數} \times 235 \times 7) \ \mathbf{mod}\ (\text{見月法}\times16)$ |


|統術 |所用常數 |已知數 |所求數 |公式 |
|:----|:--------|:------|:------|:----|
|推日月元統 | 元法、統法 | 太極上元以來年數 | 統數，入統歲數 | $x \ \mathbf{mod}\ \text{元法}\ \mathbf{mod}\ \text{統法}$ |
|推天正 | 章月、章歲| 入統歲數| 積月、閏餘| $\text{積月} = n \times \text{章月} \ \mathbf{div}\ \text{章歲}$\ $\text{閏餘} = n \times \text{章月} \ \mathbf{mod}\ \text{章歲}$|
|推正月朔 | 月法、日法、統首日| 積月| 積日、小餘、朔日干支| $\text{積日}=\text{積月} \times \text{月法} \ \mathbf{div}\ \text{日法}$\ $\text{積日小餘}=\text{積月} \times \text{月法} \ \mathbf{mod}\ \text{日法}$\ $\text{積日大餘}=\text{積日} \ \mathbf{mod}\ \text{60}$|
|推閏餘 | 章中| 閏餘| 閏月 | $(\text{章中} - 12 \times \text{閏餘}) \ \mathbf{mod}\ 7 + 1$ |
|推冬至  | 策餘、統法、統首日| 入統年 | 冬至大餘、小餘、干支| $\text{大餘} = (\text{入統年} \times \text{策餘}) \ \mathbf{div}\ \text{統法}$\ $\text{小餘} = (\text{入統年} \times \text{策餘}) \ \mathbf{mod}\ \text{統法}$|
| 推合晨所在星| 統法、周天| 積日、積日小餘| 合晨度| $\text{合晨度} = (\text{積日} \times \text{統法} + 19 \times \text{小餘}) \ \mathbf{mod}\ \text{周天} \ \mathbf{div}\ \text{統法}$ \ $\text{合晨度小餘} = (\text{積日} \times \text{統法} + 19 \times \text{小餘}) \ \mathbf{mod}\ \text{周天} \ \mathbf{mod}\ \text{統法}$|
| 推其日夜半所在星| 章歲、統法| 月小餘（積日小餘）、合晨度| 日夜半星度| $\text{日夜半星度} =\text{合晨度} \frac{\text{合晨度小餘} - \text{積日小餘} \times \text{章歲}}{統法}$ |
| 推其月夜半所在星| 月周、統法| 月小餘（積日小餘）、合晨度| 月夜半星度| $\text{月夜半星度} =\text{合晨度} \frac{\text{合晨度小餘} - \text{積日小餘} \times \text{月周}}{統法}$|
| 推諸加時| | 小餘、各盈分母| 加辰| $\text{加時} = \frac{12 \times \text{小餘}}{分母}$|
| 推月食| 會月 | 積月 | 月食月 | $\text{會餘歲積月} = \text{積月} \ \mathbf{mod}\ \text{會月}$\ $\text{次餘} = \text{會餘歲積月} \times 23 \ \mathbf{mod}\ 135$ \ $\text{次餘} + 23 \times \text{月食月} \geq 135$|

下面這張圖展示了統術所用的已知數、統術所求的未知數，以及相互之間的關係。其中方框中的是統術的名稱，而橢圓中的是統術所用的已知數或所求的未知數。

![](/Users/chunyu/Documents/notes/topics/santongli/fig/tongshu.svg)

![](/Users/chunyu/Documents/notes/topics/santongli/fig/jishu.svg) 


| 紀術 | 紀母 | 已知數 | 所求數 | 公式 |
| --------------- | --------------- | --------------- | --------------- | --------------- |
| 推五星見復 | 見中法、歲數 | 距上元年數 | 見復數、見復餘、定見復數 | $\text{定見復數} = (\text{距上元年數} \times \text{見中法}) \ \mathbf{div}\ \text{歲數}$\ $\text{見復餘} = (\text{距上元年數} \times \text{見中法}) \ \mathbf{mod}\ \text{歲數}$ |
| 推星所見中次 | 見中法、見中分 | 定見復數 | 積中、中餘、中元餘、入章中數、星見中次 | $\text{積中} \frac{\text{中餘}}{\text{歲數}} = \frac{\text{定見復數} \times \text{見中分}}{\text{歲數}}$\ $\text{星見中次} = \text{積中}\ \mathbf{mod}\ \text{元中} \ \mathbf{mod}\ \text{章中}\ \mathbf{mod}\ 12$ |
| 推星見月 | 見閏分、見月法 | 定見復數、積中、中餘 | 積月、月餘、月元餘、入章月數、月 | $\text{積月} \frac{\text{月餘}}{\text{見月法}} = \frac{\text{見閏分} \times \text{定見復數} + \text{中餘} \times 19}{\text{見月法}} + \text{積中}$\ $\text{入章月數} = \text{積月}\ \mathbf{mod}\ \text{元月}\ \mathbf{mod}\ \text{章月}$ |
| 推至日 | | 中元餘 | 氣首日名 | $\text{積日}\frac{\text{小餘}}{\text{元法}} = \frac{\text{中元餘} \times \text{中法}}{\text{元法}}$\ $\text{氣首日名} = \text{積日}\ \mathbf{mod}\ 60$ |
| 推朔日 | | 月元餘 | 朔日 | $\text{積日}\frac{\text{小餘}}{81}=\frac{\text{月元餘}\times 2392}{81}$\ $\text{朔日}=\text{積日}\ \mathbf{mod}\ 60$ |
| 推入中次日度數 | 見中法、見中日法 | 中餘、積日小餘 | 入中 | $\text{入中}=\frac{\text{中餘}\times \text{中法} + \text{小餘}\times \text{見中法}}{\text{見中日法}}$ |
| 推入月日數 | 見月法、見月日法 | 月餘、朔日小餘 | 入月日 | $\text{入月日}=\frac{\text{月餘}\times \text{月法}+\text{小餘}\times \text{見月法}}{\text{見月日法}}$ |

